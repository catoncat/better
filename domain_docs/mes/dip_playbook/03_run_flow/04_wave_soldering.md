# 波峰焊接

## 1. 概述
波峰焊接是 DIP 产线的核心焊接工序，将已插件的 PCB 通过熔融锡波完成通孔焊接。与 SMT 的回流焊不同，波峰焊需要特殊的工装治具来保护 PCB。

## 2. 波峰焊工艺

### 2.1 波峰焊基本原理
```
PCB 装载（含治具）
    ↓
助焊剂喷涂
    ↓
预热区
    ↓
焊接区（锡波）
    ↓
冷却区
    ↓
PCB 卸载
```

### 2.2 关键工艺参数
| 参数 | 说明 | 典型值 | 影响 |
|------|------|--------|------|
| 预热温度 | 预热区顶部温度 | 100-120°C | 助焊剂活化 |
| 焊接温度 | 锡锅温度 | 250-260°C | 焊接质量 |
| 传送速度 | PCB 传送速度 | 0.8-1.2 m/min | 透锡率 |
| 波峰高度 | 锡波高度 | 按设备设定 | 焊接面积 |
| 助焊剂比重 | 助焊剂浓度 | 按工艺设定 | 焊接效果 |

## 3. 波峰焊治具

### 3.1 治具作用
- 固定 PCB 通过波峰焊设备
- 保护不需焊接的区域
- 防止 PCB 变形
- 控制焊接面积

### 3.2 治具配置
| 字段 | 说明 | 示例 |
|------|------|------|
| toolingCode | 治具编码 | WS-JIG-PRDA-001 |
| productId | 适用产品 | PROD-A |
| maxLife | 设计寿命 | 5000 次 |
| currentLife | 当前使用次数 | 1234 次 |

### 3.3 治具使用流程
```
批次开始前:
    选择治具 → 验证状态 → 分配到批次

每块 PCB:
    PCB 装入治具 → 过波峰焊 → 取出 PCB → 记录使用次数

批次结束后:
    解除分配 → 治具维护（如需要）
```

## 4. 波峰焊执行流程

### 4.1 标准流程
```
1. 准备阶段
   - 设备开机预热
   - 参数设置与确认
   - 治具安装

2. 执行阶段
   - PCB 装载（TrackIn）
   - 设备自动执行焊接
   - PCB 卸载（TrackOut）

3. 检查阶段
   - 目视检查焊接质量
   - 记录结果（PASS/FAIL）
```

### 4.2 批量执行模式
波峰焊通常采用连续批量模式：
```
PCB1 → TrackIn → 焊接中 → TrackOut → PASS/FAIL
PCB2 → TrackIn → 焊接中 → TrackOut → PASS/FAIL
...
PCBn → TrackIn → 焊接中 → TrackOut → PASS/FAIL
```

### 4.3 TrackIn 数据
| 字段 | 说明 |
|------|------|
| unitId | 单件 ID |
| stationId | 波峰焊工位 |
| toolingId | 使用的治具 |
| trackInTime | 进站时间 |
| operatorId | 操作员 |

### 4.4 TrackOut 数据
| 字段 | 说明 |
|------|------|
| unitId | 单件 ID |
| stationId | 波峰焊工位 |
| trackOutTime | 出站时间 |
| result | 焊接结果 |
| processData | 工艺数据（温度/速度等） |

## 5. 焊接质量检查

### 5.1 检查项目
| 检查项 | 标准 | 检查方法 |
|--------|------|----------|
| 透锡率 | ≥75% | 目视/放大镜 |
| 虚焊 | 无 | 目视检查 |
| 短路/桥连 | 无 | 目视检查 |
| 锡尖 | 无尖锐锡尖 | 目视检查 |
| 冷焊 | 无 | 目视检查 |

### 5.2 透锡率要求
```
透锡率 = 通孔填充锡高度 / 通孔总高度 × 100%

要求：
- 一般通孔：≥75%
- 高可靠性：≥85%
- 特殊要求：100%（全透）
```

## 6. 焊接不良

### 6.1 常见不良类型
| 不良类型 | 代码 | 说明 | 可能原因 |
|----------|------|------|----------|
| 虚焊 | WS_COLD | 焊点不饱满 | 温度不足/助焊剂问题 |
| 透锡不足 | WS_INSUF | 透锡率不达标 | 速度过快/温度不足 |
| 短路 | WS_SHORT | 焊点桥连 | 间距过小/锡量过多 |
| 连焊 | WS_BRIDGE | 相邻引脚连焊 | 引脚间距/焊盘设计 |
| 锡尖 | WS_SPIKE | 尖锐锡尖 | 冷却不当 |
| 拉尖 | WS_ICICLE | 锡丝拉尖 | 分离速度/温度 |

### 6.2 不良处理
```
发现焊接不良
    ↓
登记不良（类型 + 位置）
    ↓
判定
    ├─ 可返修 → 创建返修任务 → 重回波峰焊或手工补焊
    └─ 不可返修 → 报废
```

## 7. 焊接返修

### 7.1 返修方式
| 方式 | 适用场景 |
|------|----------|
| 重过波峰焊 | 大面积透锡不足 |
| 手工补焊 | 局部虚焊/冷焊 |
| 吸锡处理 | 短路/桥连 |

### 7.2 返修流程
```
1. 接收返修任务
2. 确认不良位置和类型
3. 选择返修方式
4. 执行返修
5. 复检焊接质量
6. 记录返修结果
```

## 8. 工艺数据采集

### 8.1 采集内容
| 数据项 | 说明 | 来源 |
|--------|------|------|
| 焊接温度 | 实际锡锅温度 | 设备接口 |
| 预热温度 | 预热区温度 | 设备接口 |
| 传送速度 | 实际传送速度 | 设备接口 |
| 环境温度 | 车间环境温度 | 传感器 |
| 环境湿度 | 车间环境湿度 | 传感器 |

### 8.2 数据用途
- 质量追溯
- SPC 统计分析
- 异常预警
- 工艺优化

## 9. 设备维护

### 9.1 日常维护项
| 维护项 | 频率 | 说明 |
|--------|------|------|
| 锡渣清理 | 每班 | 清理锡锅表面锡渣 |
| 助焊剂检查 | 每班 | 检查比重和液位 |
| 传送带检查 | 每班 | 检查传送顺畅 |
| 温度校准 | 每周 | 校准温度传感器 |

### 9.2 治具维护
| 维护项 | 频率 | 说明 |
|--------|------|------|
| 清洁 | 每批次 | 清理残留助焊剂 |
| 检查变形 | 每批次 | 检查是否变形 |
| 寿命检查 | 系统自动 | 达到寿命预警 |

## 10. 页面与操作

### 10.1 执行页面
路径：`/mes/execution`

波峰焊工位操作：
- 设备参数显示
- PCB 扫码进站
- 治具选择/扫码
- 出站结果录入
- 不良登记

### 10.2 工艺参数监控
- 实时温度显示
- 参数超限报警
- 历史数据查询

## 11. 相关 API

| 操作 | API | 说明 |
|------|-----|------|
| 进站 | `POST /api/stations/:stationCode/track-in` | 含治具信息 |
| 出站 | `POST /api/stations/:stationCode/track-out` | 含工艺数据 |
| 登记不良 | `POST /api/defects` | |
| 记录治具使用 | `POST /api/tooling/:id/usage` | |
