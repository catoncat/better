# MES 系统阶段1 用户使用指南

本文档从不同角色用户的视角，详细描述 MES 系统阶段1（M1-M1.8）的完整操作流程。

**最后更新**: 2025-12-28

---

## 一、系统角色与权限概览

### 1.1 预设角色

| 角色 | 代码 | 权限范围 | 典型用户 |
|------|------|---------|---------|
| 系统管理员 | `ADMIN` | 全部系统管理权限 + 基础查看权限 | IT 管理员 |
| 计划员 | `PLANNER` | 工单接收/发布/取消、批次创建、路由/追溯查看 | 生产计划员 |
| 工艺工程师 | `ENGINEER` | 路由配置/编译/创建、工单/批次/追溯查看 | 工艺/制程工程师 |
| 品质工程师 | `QE` | FAI/OQC/缺陷处置（M2）、追溯查询/导出 | 品质工程师 |
| 产线主管 | `LINE_SUPERVISOR` | 批次创建/授权/撤销/关闭、进出站、追溯 | 产线主管/班组长 |
| 操作员 | `OPERATOR` | 进站/出站、追溯查看 | 一线操作员 |

### 1.2 数据范围 (Data Scope)

| 类型 | 说明 |
|------|------|
| `ALL` | 全部产线数据 |
| `ASSIGNED_LINES` | 仅用户所管辖产线的数据 |
| `ASSIGNED_STATIONS` | 仅用户绑定工位的数据 |

---

## 二、登录与导航

### 2.1 登录系统

1. 打开浏览器访问系统 URL
2. 输入邮箱和密码
3. 点击「登录」按钮

### 2.2 侧边栏导航

登录后根据权限可见以下模块：

| 模块 | 菜单项 | 所需权限 |
|------|-------|---------|
| 生产执行 | 工单管理 | `WO_READ` |
| | 批次管理 | `RUN_READ` |
| | 工位执行 | `EXEC_READ` / `EXEC_TRACK_IN` / `EXEC_TRACK_OUT` |
| | 路由管理 | `ROUTE_READ` |
| | 路由版本 | `ROUTE_READ` |
| | 追溯查询 | `TRACE_READ` |
| 系统管理 | 用户管理 | `SYSTEM_USER_MANAGE` |
| | 角色管理 | `SYSTEM_ROLE_MANAGE` |
| | 系统设置 | `SYSTEM_CONFIG` |
| | 集成管理 | `SYSTEM_INTEGRATION` |

---

## 三、角色操作流程

### 3.1 系统管理员 (ADMIN)

#### 3.1.1 用户管理

**路径**: 侧边栏 → 系统管理 → 用户管理

**操作步骤**:
1. 点击「新增用户」按钮
2. 填写用户信息（邮箱、姓名）
3. 选择用户角色（可多选）
4. 如需绑定产线/工位，选择对应选项
5. 点击「保存」

**编辑用户**:
1. 在用户列表中找到目标用户
2. 点击行操作「编辑」
3. 修改角色或绑定信息
4. 点击「保存」

#### 3.1.2 角色管理

**路径**: 侧边栏 → 系统管理 → 角色管理

**新增自定义角色**:
1. 点击「新增角色」
2. 填写角色代码、名称、描述
3. 选择数据范围（全部产线 / 仅管辖产线 / 仅绑定工位）
4. 勾选权限点
5. 点击「保存」

**编辑角色**:
1. 在角色卡片中点击「编辑」
2. 修改名称、描述、权限（系统角色仅能修改名称和描述）
3. 点击「保存」

> **注意**: 系统预设角色不可删除，仅能修改名称和描述。

#### 3.1.3 集成同步

**路径**: 侧边栏 → 系统管理 → 集成管理

**手动触发同步**:
1. 找到需要同步的实体类型（如 ERP 工艺路线、工单、物料等）
2. 查看「上次同步时间」和「游标更新时间」确认状态
3. 点击「手动同步」按钮
4. 等待同步完成，状态变为 `SUCCESS`

**可同步实体**:
- ERP: 工艺路线、工单、物料、BOM、工作中心
- TPM: 设备主数据、设备状态日志、维护任务

---

### 3.2 计划员 (PLANNER)

#### 3.2.1 接收工单

**路径**: 侧边栏 → 生产执行 → 工单管理

**操作步骤**:
1. 点击「接收工单」按钮
2. 填写工单信息：
   - **工单号**: 唯一标识，如 `WO-2025-0001`
   - **产品编码**: 产品型号
   - **计划数量**: 生产数量
   - **路由**: 点击下拉框搜索并选择工艺路线
   - **计划开始/结束日期**: 可选
3. 点击「提交」

**UX 评估**:
- 路由选择支持搜索，无需记忆编码
- 表单验证清晰，必填项有提示

#### 3.2.2 发布工单

**前提**: 工单状态为「已接收」(RECEIVED)

**操作步骤**:
1. 在工单列表中找到目标工单
2. 点击行末尾「...」操作按钮
3. 选择「发布工单」
4. 确认后工单状态变为「已发布」(RELEASED)

#### 3.2.3 创建生产批次

**前提**: 工单状态为「已发布」(RELEASED) 或「进行中」(IN_PROGRESS)

**操作步骤**:
1. 在工单列表中找到目标工单
2. 点击行末尾「...」操作按钮
3. 选择「创建批次」
4. 填写批次信息：
   - **产线**: 选择执行产线
   - **班次**: 可选，如 A/B/C 班
5. 点击「创建」

**结果**: 创建一个状态为「准备中」(PREP) 的批次

---

### 3.3 工艺工程师 (ENGINEER)

#### 3.3.1 查看路由

**路径**: 侧边栏 → 生产执行 → 路由管理

**操作步骤**:
1. 使用搜索框按路由编码或名称搜索
2. 可按来源（MES/ERP）筛选
3. 点击路由行进入详情页

**路由详情页内容**:
- 路由基本信息（编码、名称、产品、来源、有效期）
- 步骤列表（步骤号、工序、站点组、站点类型、FAI 标识、来源步骤）
- 执行语义配置表

#### 3.3.2 配置执行语义

**权限**: `ROUTE_CONFIGURE`

**操作步骤**:
1. 在路由详情页「执行语义配置」区域点击「新增配置」
2. 选择配置范围：
   - **整条路由**: 对所有步骤生效
   - **工序**: 对特定工序的所有步骤生效
   - **步骤**: 对特定步骤生效
   - **来源步骤**: 按 ERP 来源步骤匹配
3. 配置项：
   - **站点类型**: 手动 / 自动 / 批处理 / 测试
   - **站点组**: 指定允许执行的站点组
   - **允许站点**: 精确指定允许的工位
   - **需要首件**: 是否需要 FAI（M2 生效）
   - **需要授权**: 是否需要授权才能执行
   - **采集项标识**: 绑定数据采集项 ID
   - **采集映射 (JSON)**: 自动采集字段映射
   - **扩展信息 (JSON)**: 其他元数据
4. 点击「保存配置」

#### 3.3.3 编译路由

**权限**: `ROUTE_COMPILE`

**方式一: 从路由详情页**
1. 打开路由详情页
2. 点击右上角「编译路由」按钮
3. 等待编译完成，查看结果

**方式二: 从路由版本页**
1. 进入「路由版本」页面
2. 输入路由编码
3. 点击「编译路由」
4. 查看版本列表，确认状态为 `READY`

**编译失败处理**:
- 版本状态显示为 `INVALID`
- 查看「错误」列的详细信息
- 常见错误：站点组未映射、步骤缺少配置
- 修正配置后重新编译

---

### 3.4 产线主管 (LINE_SUPERVISOR)

#### 3.4.1 授权批次

**路径**: 侧边栏 → 生产执行 → 批次管理

**前提**: 批次状态为「准备中」(PREP)

**操作步骤**:
1. 在批次列表中找到目标批次
2. 确认已绑定有效的路由版本（状态 READY）
3. 点击行末尾「授权」按钮
4. 批次状态变为「已授权」(AUTHORIZED)

**UX 评估**:
- 当前为简化逻辑，跳过 FAI 检验（M2 会完善）
- 无 Line Readiness Check（M2 会完善）

#### 3.4.2 撤销授权

**前提**: 批次状态为「已授权」(AUTHORIZED)

**操作步骤**:
1. 点击批次行末尾「撤销授权」按钮
2. 批次状态恢复为「准备中」(PREP)

#### 3.4.3 查看批次详情

**操作步骤**:
1. 在批次列表中点击批次号链接
2. 进入批次详情页

**详情页内容**:
- 批次基本信息（批次号、状态、产线、班次、时间）
- 路由版本信息（编码、名称、版本号）
- 进度统计卡片：
  - 计划数量
  - 实际生产（完成率）
  - 进行中（排队 + 在站）
  - 异常（不良/报废/冻结）
- 最近生产的 20 个产品单元列表

---

### 3.5 操作员 (OPERATOR)

#### 3.5.1 选择工位

**路径**: 侧边栏 → 生产执行 → 工位执行

**操作步骤**:
1. 在「选择工位」卡片中点击下拉框
2. 选择当前操作的物理工位
3. 页面显示该工位的队列和操作区

#### 3.5.2 产品进站 (Track In)

**权限**: `EXEC_TRACK_IN`

**操作步骤**:
1. 选择工位后，点击「进站 (Track In)」标签页
2. 填写表单：
   - **产品序列号 (SN)**: 扫描或输入产品条码
   - **工单号**: 输入关联工单号
   - **批次号**: 输入关联批次号
3. 点击「确认进站」

**验证规则**:
- 批次必须已授权
- 当前步骤的站点组必须包含所选工位
- TPM 设备状态必须正常

**UX 评估**:
- 工单号和批次号需手动输入，M2 考虑扫码自动关联
- SN 输入框自动聚焦，便于连续扫码

#### 3.5.3 查看工位队列

**操作步骤**:
1. 选择工位后，左侧「当前队列」卡片自动显示在站产品
2. 队列每 10 秒自动刷新
3. 可点击「刷新」按钮手动刷新

**队列信息**:
- 产品 SN
- 当前步骤号
- 进站时间
- 「出站」快捷按钮

#### 3.5.4 产品出站 (Track Out)

**权限**: `EXEC_TRACK_OUT`

**方式一: 从队列快捷出站**
1. 在队列中找到目标产品
2. 点击「出站」按钮
3. 表单自动填充 SN 和批次号
4. 选择结果（合格 PASS / 不合格 FAIL）
5. 点击「确认出站」

**方式二: 手动输入**
1. 点击「出站 (Track Out)」标签页
2. 手动输入 SN 和批次号
3. 选择结果
4. 点击「确认出站」

**结果处理**:
- **PASS**: 产品进入下一步骤或完成整条路由
- **FAIL**: 产品标记为 NG 状态（M2 会增加处置流程）

**UX 评估**:
- 队列快捷出站减少输入
- 无数据采集表单，仅选择 PASS/FAIL（M2 会完善）
- FAIL 后无处置流程（M2 会完善）

---

### 3.6 品质工程师 (QE)

#### 3.6.1 追溯查询

**路径**: 侧边栏 → 生产执行 → 追溯查询

**操作步骤**:
1. 在「产品序列号 (SN)」输入框输入或扫描产品条码
2. 选择查询模式：
   - **批次版本**: 查询该产品在当前批次的生产记录
   - **最新版本**: 查询该产品最新的生产状态
3. 按回车或点击「查询」按钮

**查询结果**:
1. **产品信息卡片**:
   - 序列号、状态、工单号、批次号

2. **路由信息卡片**:
   - 路由编码、来源系统、版本号、编译时间

3. **执行记录表格**:
   - 步骤号、工序名称、进站时间、出站时间、结果

4. **采集数据表格**（如有）:
   - 步骤、数据项名称、值、判定结果

5. **缺陷记录表格**（如有）:
   - 缺陷代码、位置、数量、状态

6. **物料追溯表格**（如有）:
   - 位置、物料编码、批次号、是否关键件

---

## 四、典型端到端流程

### 4.1 新产品首次生产

```
管理员: 同步 ERP 路由 → 工艺工程师: 配置执行语义 → 编译路由 →
计划员: 接收工单 → 发布工单 → 创建批次 →
产线主管: 授权批次 →
操作员: 进站 → 出站 (每个步骤) →
品质工程师: 追溯查询
```

### 4.2 日常生产

```
计划员: 接收工单 → 发布工单 → 创建批次 →
产线主管: 授权批次 →
操作员: 进站 → 出站 (每个步骤) →
品质工程师: 追溯查询
```

---

## 五、产品体验问题清单

以下问题已识别，将在后续版本改进：

### 高优先级 (M2 解决)
| 问题 | 影响 | 计划 |
|------|------|------|
| 进站需手动输入工单号和批次号 | 操作效率低 | M2 支持扫码自动关联 |
| 出站无数据采集表单 | 无法收集过程数据 | M2 实现动态采集表单 |
| FAIL 后无处置流程 | NG 产品无后续处理 | M2 实现 Rework/Scrap/Hold |
| 授权无 FAI 检验 | 质量风险 | M2 实现 FAI 任务流 |
| 授权无 Line Readiness Check | 生产准备不足 | M2 实现就绪检查 |

### 中优先级
| 问题 | 建议改进 |
|------|---------|
| 路由版本页需手动输入编码 | 提供路由选择器 |
| 工位队列无 SN 搜索 | 大批量时难找产品 |
| 批次详情无步骤进度 | 增加步骤级统计 |

### 低优先级
| 问题 | 建议改进 |
|------|---------|
| 角色权限显示为代码 | 显示中文标签 |
| 时间格式不一致 | 统一为 YYYY-MM-DD HH:mm:ss |

---

## 六、快捷键与技巧

1. **追溯查询**: 输入 SN 后按 `Enter` 直接查询
2. **进站表单**: SN 输入框自动聚焦，扫码后立即可扫下一个
3. **队列刷新**: 点击刷新按钮或等待 10 秒自动刷新
4. **批量筛选**: 工单/批次列表支持多状态同时筛选

---

## 七、错误处理

### 常见错误及解决方案

| 错误信息 | 原因 | 解决方案 |
|---------|------|---------|
| `Run not authorized` | 批次未授权 | 联系产线主管授权批次 |
| `Step mismatch` | 产品当前步骤与工位不匹配 | 检查产品应在哪个工位 |
| `Station not in allowed list` | 工位不在允许列表 | 联系工艺工程师检查配置 |
| `Equipment unavailable` | TPM 设备状态异常 | 联系设备维护 |
| `Route version not ready` | 路由版本编译失败 | 联系工艺工程师重新编译 |

---

## 八、验收检查清单

### M1 基础功能
- [x] 用户可登录并看到权限范围内的菜单
- [x] 计划员可接收、发布工单并创建批次
- [x] 产线主管可授权和撤销批次
- [x] 操作员可进站和出站
- [x] 品质工程师可追溯查询

### M1.5 路由集成
- [x] 管理员可同步 ERP 路由
- [x] 工艺工程师可配置执行语义
- [x] 工艺工程师可编译路由
- [x] 批次绑定冻结的路由版本

### M1.6 集成基础
- [x] 管理员可同步 ERP 主数据
- [x] 管理员可同步 TPM 数据
- [x] 同步状态可查看

### M1.7 体验优化
- [x] 工位队列显示在站产品
- [x] 追溯查询页面完整
- [x] 批次详情页显示进度

### M1.8 权限控制
- [x] 不同角色看到不同菜单
- [x] 操作按钮根据权限显示/隐藏
- [x] 角色可创建和编辑
