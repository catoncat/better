# 追溯审计员 (Trace) 操作指南

## 角色概述

追溯审计员负责产品追溯查询与追溯分析，通常用于质量审计与客诉分析。

| 属性 | 值 |
|------|-----|
| 角色代码 | `trace` |
| 数据范围 | 全部 (ALL) |
| 默认首页 | `/mes/trace` |

## 权限清单

### 追溯查询
- ✓ 追溯查询 (`trace:read`)
- 导出报告 (`trace:export`，预留)

## 可访问菜单

```
质量管理
└── 追溯查询      /mes/trace          [完整操作]

通知中心          /notifications
```

---

## 核心功能操作

### 1. 查询产品履历

1. 进入 **追溯查询** 页面
2. 输入产品序列号（SN）
3. 查看生产履历：
   - 路由信息
   - 过站记录
   - 采集数据
   - 质量检验
   - 缺陷记录
   - 上料记录
   - 物料追溯
   - Ingest/载具追溯（如有）

### 2. 导出追溯报告（暂未开放）

当前版本未提供导出入口，后续若开放将补充操作指引。

---

### 3. 可追溯数据点说明

追溯查询可查看以下数据点：

#### 3.1 基础追溯数据（页面可见）

| 数据类型 | 说明 | 来源 |
|----------|------|------|
| 路由版本快照 | 生产时使用的路由版本 | RouteVersion |
| 过站记录 | TrackIn/TrackOut 时间、结果 | TrackRecord |
| 数据采集值 | 工序采集的参数值 | DataValue |
| 质量检验 | FAI/OQC/过程检验结果 | Inspection |
| 缺陷记录 | 缺陷代码/数量/状态 | Defect |
| 上料记录 | 站位物料绑定与校验 | LoadingRecord |
| 物料追溯 | 关键料批次/位置 | MaterialTrace |
| Ingest/载具追溯 | 载具轨迹与数据采集 | CarrierTrack / CarrierDataValue |

#### 3.2 当前未展示的数据（API 层存在）

- 就绪检查/豁免记录

#### 3.4 追溯查询示例

**查询产品的完整生产履历**：
1. 输入产品序列号
2. 查看结果：
   - 路由版本 + 工序列表
   - 各工序 TrackIn/TrackOut 时间
   - 上料记录（物料批次、扫码结果）
   - 检验记录（FAI/OQC 判定、签字信息）
   - 豁免记录（如有）
   - 准备记录（钢网清洗、刮刀点检等）
   - 时间规则状态（如锡膏暴露时间）

**查询物料批次的反向追溯**：
1. 切换查询类型为 **物料批次**
2. 输入物料编码与批次号
3. 点击目标 SN 查看完整履历
