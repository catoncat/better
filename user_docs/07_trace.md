# 追溯审计员 (Trace) 操作指南

## 角色概述

追溯审计员负责产品追溯查询与报告导出，通常用于质量审计与客诉分析。

| 属性 | 值 |
|------|-----|
| 角色代码 | `trace` |
| 数据范围 | 全部 (ALL) |
| 默认首页 | `/mes/trace` |

## 权限清单

### 追溯查询
- ✓ 追溯查询 (`trace:read`)
- ✓ 导出报告 (`trace:export`)

## 可访问菜单

```
质量管理
└── 追溯查询      /mes/trace          [完整操作]

通知中心          /notifications
```

---

## 核心功能操作

### 1. 查询产品履历

1. 进入 **追溯查询** 页面
2. 输入产品序列号（SN）
3. 查看生产履历：
   - 路由步骤
   - 过站记录
   - 质量检验
   - 上料记录

### 2. 导出追溯报告

1. 在追溯结果页选择 **导出报告**
2. 按需要选择导出范围/格式
3. 下载并归档报告

---

### 3. 可追溯数据点说明

追溯查询可查看以下数据点：

#### 3.1 基础追溯数据

| 数据类型 | 说明 | 来源 |
|----------|------|------|
| 路由版本快照 | 生产时使用的路由版本 | RouteVersion |
| 过站记录 | TrackIn/TrackOut 时间、操作员 | TrackRecord |
| 数据采集值 | 工序采集的参数值 | DataValue |
| 检验记录 | FAI/OQC/过程检验结果 | Inspection |

#### 3.2 准备记录

| 数据类型 | 说明 | 来源 |
|----------|------|------|
| 上料记录 | 站位物料绑定、扫码结果 | LoadingRecord |
| 就绪检查记录 | Readiness 检查结果 | ReadinessCheckItem |
| 豁免记录 | 豁免操作人、原因 | ReadinessCheckItem.waive* |

#### 3.3 新增追溯数据点

以下是近期新增的可追溯数据：

| 数据类型 | 说明 | 字段 |
|----------|------|------|
| FAI 签字记录 | 首件签字确认 | signedBy, signedAt, signatureRemark |
| 豁免操作记录 | 准备项/时间规则豁免 | waivedBy, waivedAt, waiveReason |
| 钢网清洗记录 | 钢网清洗操作 | StencilCleaningRecord |
| 刮刀点检记录 | 刮刀使用前点检 | SqueegeeUsageRecord |
| 夹具使用记录 | 夹具使用与寿命 | FixtureUsageRecord |
| 炉温程式使用记录 | 回流焊程式配置 | ReflowProfileUsage |
| 时间规则实例 | 锡膏暴露/水洗时间 | TimeRuleInstance |
| 维修记录 | 设备/夹具/钢网维修 | MaintenanceRecord |

#### 3.4 追溯查询示例

**查询产品的完整生产履历**：
1. 输入产品序列号
2. 查看结果：
   - 路由版本 + 工序列表
   - 各工序 TrackIn/TrackOut 时间
   - 上料记录（物料批次、扫码结果）
   - 检验记录（FAI/OQC 判定、签字信息）
   - 豁免记录（如有）
   - 准备记录（钢网清洗、刮刀点检等）
   - 时间规则状态（如锡膏暴露时间）

**查询物料批次的反向追溯**：
1. 输入物料批次号
2. 查看使用该批次的所有产品 SN 列表
3. 可进一步查看每个产品的详细履历
