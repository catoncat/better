# 生产计划员 (Planner) 操作指南

## 角色概述

生产计划员负责工单的全生命周期管理，从接收 ERP 工单到发布生产、创建批次、跟踪进度。

| 属性 | 值 |
|------|-----|
| 角色代码 | `planner` |
| 数据范围 | 全部 (ALL) |
| 默认首页 | `/mes/work-orders` |

## 权限清单

### 工单管理
- ✓ 查看工单 (`wo:read`)
- ✓ 接收工单 (`wo:receive`)
- ✓ 发布工单 (`wo:release`)
- ✓ 更新工单 (`wo:update`)

### 批次管理
- ✓ 查看批次 (`run:read`)
- ✓ 创建批次 (`run:create`)

### 其他
- ✓ 查看路由 (`route:read`)
- ✓ 追溯查询 (`trace:read`)

## 可访问菜单

```
生产执行
├── 工单管理      /mes/work-orders     [完整操作]
├── 批次管理      /mes/runs            [创建/查看]
├── 路由管理      /mes/routes          [只读]
├── 路由版本      /mes/route-versions  [只读]
└── 追溯查询      /mes/trace           [只读]

通知中心          /notifications
```

---

## 核心功能操作

### 1. 工单管理

#### 1.1 查看工单列表
1. 导航至 **生产执行 → 工单管理**
2. 使用筛选条件：
   - 工单状态（待接收、已接收、生产中、已完成等）
   - 产品型号
   - 日期范围
3. 点击工单行查看详情

#### 1.2 接收 ERP 工单
当 ERP 系统推送新工单后：
1. 在工单列表找到状态为 **待接收** 的工单
2. 点击 **接收** 按钮
3. 确认工单信息：
   - 产品型号
   - 计划数量
   - 交货日期
4. 确认接收

> **说明**: 接收后工单状态变为 **已接收**，等待分配路由和发布。

#### 1.3 发布工单
工单接收后，需要发布才能开始生产：
1. 选择已接收的工单
2. 点击 **发布** 按钮
3. 确认发布条件：
   - 已关联有效路由版本
   - 物料准备就绪（如需要）
4. 确认发布

> **说明**: 发布后工单状态变为 **已发布**，可以创建批次开始生产。

#### 1.4 更新工单
1. 选择目标工单
2. 点击 **编辑** 按钮
3. 可修改内容：
   - 计划数量（仅未开始生产部分）
   - 交货日期
   - 优先级
   - 备注信息
4. 保存修改

### 2. 批次管理

#### 2.1 查看批次列表
1. 导航至 **生产执行 → 批次管理**
2. 使用筛选条件：
   - 批次状态
   - 所属工单
   - 创建日期

> **批次状态参考**：
> - `PREP`：准备中/待授权
> - `AUTHORIZED`：已授权
> - `IN_PROGRESS`：生产中
> - `ON_HOLD`：OQC 不合格，待 MRB 决策
> - `COMPLETED`：完成（OQC 通过或 MRB 放行）
> - `CLOSED_REWORK`：返修闭环（已创建返修 Run）
> - `SCRAPPED`：整批报废

#### 2.2 创建批次
1. 方式一：从工单页面
   - 在工单详情页点击 **创建批次**
2. 方式二：从批次页面
   - 点击 **新建批次**
   - 选择关联工单

3. 填写批次信息：
   - 批次数量（从工单剩余数量中分配）
   - 序列号范围（如适用）
   - 计划开始时间
   - 备注

4. 确认创建

> **说明**: 创建后批次状态为 **待授权**（`PREP`），需要产线组长授权后才能开始执行。

#### 2.3 查看批次详情
1. 点击批次行查看详情
2. 可查看内容：
   - 基本信息（工单、产品、数量）
   - 执行进度（已完成/在制/待执行数量）
   - 各工位状态
   - 时间轴（创建、授权、开始、完成时间）

---

### 3. 进度跟踪

#### 3.1 工单进度监控
1. 在工单列表查看进度列
2. 或进入工单详情页查看：
   - 完成率
   - 各批次状态汇总
   - 预计完成时间

> **关注项**：出现 `ON_HOLD` / `CLOSED_REWORK` / `SCRAPPED` 时需同步评估交期与返修安排。

#### 3.2 追溯查询
1. 导航至 **生产执行 → 追溯查询**
2. 按序列号或批次号查询
3. 查看产品的完整生产履历

---

## 工作流程

### 典型日常工作流

```
早班开始
    │
    ▼
查看待接收工单 ──→ 接收新工单
    │
    ▼
检查已接收工单 ──→ 确认路由已配置 ──→ 发布工单
    │
    ▼
根据产能创建批次
    │
    ▼
监控生产进度
    │
    ▼
处理异常（调整优先级、更新交期等）
```

### 工单状态流转

```
待接收 → 已接收 → 已发布 → 生产中 → 已完成
                    ↓
                  已取消
```

---

## 常见场景

### 场景1: 紧急插单
1. 接收紧急工单
2. 设置高优先级
3. 快速发布
4. 创建批次并通知产线组长优先授权

### 场景2: 工单变更
1. 更新工单计划数量
2. 如需增加，创建新批次
3. 如需减少，与产线组长协调处理在制批次

### 场景3: 交期延误预警
1. 监控进度异常的工单
2. 评估延误风险
3. 与相关人员沟通调整计划

---

## 与其他角色的协作

| 协作角色 | 协作内容 |
|----------|----------|
| 工艺工程师 | 确认路由配置，解决工艺问题 |
| 产线组长 | 批次授权，生产调度协调 |
| 质量工程师 | 质量问题影响交期评估 |

---

## 注意事项

1. **发布前检查**: 确保工单已关联正确的路由版本
2. **批次规划**: 根据产线产能合理规划批次大小
3. **及时跟进**: 关注批次授权状态，确保生产顺利开始
4. **异常处理**: 发现进度异常及时协调处理
