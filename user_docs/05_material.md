# 物料员 (Material) 操作指南

## 角色概述

物料员负责 SMT 上料相关操作，包括加载站位表、扫码验证、物料替换与记录核对。

| 属性 | 值 |
|------|-----|
| 角色代码 | `material` |
| 数据范围 | 分配的产线 (ASSIGNED_LINES) |
| 默认首页 | `/mes/loading` |

## 权限清单

### 上料防错
- ✓ 查看上料记录 (`loading:view`)
- ✓ 执行上料验证 (`loading:verify`)

### 批次查看
- ✓ 查看批次 (`run:read`)

## 可访问菜单

```
生产执行
├── 上料防错      /mes/loading        [完整操作]
└── 追溯查询      /mes/trace          [只读]

通知中心          /notifications
```

> **注意**: 物料员只能看到其绑定产线下的数据。

---

## 核心功能操作

### 1. 加载站位表

在批次上料前，需要先加载站位期望表：

1. 进入 **上料防错** 页面
2. 选择 PREP 状态批次
3. 点击 **加载站位表**

> **说明**：站位表来自路由/映射配置，用于后续扫码校验。
> 若已开始上料或站位映射缺失，加载会失败并返回错误码（见“常见异常与处理”）。

### 2. 上料验证

1. 选择批次后，进入扫码区
2. 扫描站位码
3. 扫描物料码（含物料号 + 批次号）
4. 系统返回校验结果：
   - PASS：校验通过，记录生效
   - WARNING：可继续但需关注
   - FAIL：禁止继续，需处理异常

> **条码格式**：`物料编码|批次号`（竖线分隔）。

### 3. 物料替换

1. 在扫码面板开启 **换料模式**
2. 扫描站位码
3. 扫描新的物料码
4. 填写原因并确认

> **说明**：站位解锁/强制重置需要更高权限（通常由工艺工程师处理）。系统会记录解锁原因。

---

## 常见异常与处理

### 1) 加载站位表失败

- `SLOT_MAPPING_MISSING`：站位缺少物料映射 → 去 `/mes/loading/slot-config` 补充映射后重试
- `LOADING_ALREADY_STARTED`：已存在上料记录 → 不能重新加载，继续上料或处理异常

### 2) 上料验证异常

- `SLOT_LOCKED`：站位已锁定 → 需解锁后重试
- `SLOT_ALREADY_LOADED`：站位已上料 → 使用“换料模式”完成更换
- `MATERIAL_LOT_NOT_FOUND` / `MATERIAL_LOT_AMBIGUOUS`：条码无法解析或批次不唯一 → 检查条码与批次数据

---

### 4. 锡膏时间规则查看

物料员可以查看当前锡膏的暴露时间状态，确保锡膏在有效期内使用。

#### 4.1 锡膏暴露时间规则

- **时限**: 锡膏开封后 24 小时内必须使用完毕
- **预警时间**: 剩余 2 小时时系统发送预警
- **超时处理**: 超过 24 小时的锡膏需报废或由质量人员豁免

#### 4.2 查看锡膏状态

1. 在上料防错页面查看当前批次关联的锡膏
2. 锡膏状态显示：
   - 批次号
   - 开封时间
   - 剩余有效时间
   - 状态（正常/预警/超时）

#### 4.3 锡膏状态标识

| 状态 | 显示 | 说明 |
|------|------|------|
| 正常 | 绿色 | 剩余时间 > 2 小时 |
| 预警 | 黄色 | 剩余时间 ≤ 2 小时 |
| 超时 | 红色 | 已超过 24 小时暴露时限 |

> **注意**: 若锡膏显示预警或超时状态，应通知组长处理。超时锡膏不可继续使用，除非由质量人员豁免。
