# MES 系统 AI 浏览器验收计划

> 创建时间: 2026-01-14
> 状态: 进行中

## 目标

使用 `agent-browser` skill 按照 `user_docs/demo/guide.md` 演示指南自动化验收 MES 系统的 UI 流程，并记录发现的问题。

## 执行记录（小步同步）

> 约定：每完成/尝试一小步操作，就在此追加一条记录（即使没发现问题也要写）。

### 当前进度（快速概览）
- [x] 环境检查 - 确认服务可用
- [ ] 阶段 1: 工单与批次创建
- [ ] 阶段 2: 产前检查 Readiness
- [ ] 阶段 3: 上料防错
- [ ] 阶段 4: FAI 首件检验
- [ ] 阶段 5: Run 授权
- [ ] 阶段 6: 批量执行过站
- [ ] 阶段 7: 收尾与 OQC
- [ ] 阶段 8: 追溯验证
- [ ] 输出验收报告

### 日志
- 2026-01-14 12:10: 后端 `http://localhost:3000/api/health` 返回 200；前端 `http://localhost:3001/` 返回 200。
- 2026-01-14 12:12: `agent-browser` session=`mes-accept-20260114` 打开 `http://localhost:3001`，尝试手动输入账号 `planner@example.com` / `Test123!` 登录后停留在 `/login?...` 且输入框变为 disabled（未见报错）。刷新后恢复正常；改用「选择测试账号」→ planner 登录成功并跳转到 `/mes/work-orders`。
- 2026-01-14 12:16: 在 `/mes/work-orders` 搜索 `WO-MGMT-SMT-QUEUE`，可见卡片信息；但状态显示为「进行中」（与阶段 1 预期的 RECEIVED 不一致，见问题记录）。
- 2026-01-14 12:17: 点击该工单的「创建批次」弹窗，看到产线预选 `LINE-A` 且不可编辑；未继续创建（先转去按计划验证“接收外部工单/下发”路径）。
- 2026-01-14 12:20: 打开「接收工单」弹窗，准备新建工单以覆盖“RECEIVED→RELEASED→创建 Run”链路（进行中）。

---

## 数据策略

| 数据类型 | 来源 | 说明 |
|----------|------|------|
| 用户/权限 | `db:seed` | 6 种角色用户已预置 |
| 产线/工位 | `db:seed` | LINE-A (SMT), LINE-DIP-A (DIP) |
| 路由 | `db:seed` | PCBA-STD-V1 (SMT), PCBA-DIP-V1 (DIP) |
| **工单** | **新建** | 通过 UI 接收外部工单或使用 `WO-MGMT-SMT-QUEUE` |
| **批次** | **新建** | 通过 UI 创建 Run |
| **单件** | **新建** | TrackIn 时自动创建或手动生成 |
| **FAI/OQC** | **新建** | 通过 UI 创建和完成检验 |

> **关键点**：验收应包含新建操作（工单下发/创建批次/创建 FAI 等），而非只验证已有数据。

---

## 前置准备

### 1. 环境准备
```bash
# 重置数据库并创建基础数据
bun run db:seed

# （可选）添加演示数据以展示多状态场景
bun apps/server/scripts/seed-demo.ts

# 启动开发服务器
bun run dev
```

### 2. 验证服务可用
- 访问 http://localhost:3001 确认前端可访问
- 访问 http://localhost:3000/api/health 确认后端健康

---

## 验收流程（按演示指南 2.0-2.8）

### 阶段 1：工单与批次创建 (2.1)
**页面**: `/mes/work-orders`
**状态**: [ ] 未开始

| 步骤 | 操作 | 预期结果 | 状态 |
|------|------|----------|------|
| 1.1 | 登录 planner@example.com (Test123!) | 成功进入系统 | [x] |
| 1.2 | 导航到工单管理页面 | 显示工单列表 | [x] |
| 1.3 | 选择 `WO-MGMT-SMT-QUEUE` (RECEIVED 状态) | 工单详情可见 | [x] |
| 1.4 | 点击「下发」选择 `LINE-A` | 工单状态变为 RELEASED | [ ] |
| 1.5 | 点击「创建批次」 | **新建 Run**，跳转到 Run 详情页 | [ ] |

### 阶段 2：产前检查 Readiness (2.2)
**页面**: `/mes/runs/{runNo}`
**状态**: [ ] 未开始

| 步骤 | 操作 | 预期结果 | 状态 |
|------|------|----------|------|
| 2.1 | 在 Readiness 卡片点击「正式检查」| 显示检查结果 | [ ] |
| 2.2 | 若失败，点击「豁免」填写原因 | 豁免成功，状态变为 WAIVED | [ ] |
| 2.3 | 确认 Readiness 状态为 PASSED | 绿色通过标识 | [ ] |

### 阶段 3：上料防错 (2.3)
**页面**: `/mes/loading`
**状态**: [ ] 未开始

| 步骤 | 操作 | 预期结果 | 状态 |
|------|------|----------|------|
| 3.1 | 输入 Run 号 | 加载 Run 信息 | [ ] |
| 3.2 | 点击「加载站位表」 | 显示站位期望列表 | [ ] |
| 3.3 | 完成上料验证 | 显示 PASS 状态 | [ ] |

### 阶段 4：FAI 首件检验 (2.4)
**页面**: `/mes/runs/{runNo}` + `/mes/fai` + `/mes/execution`
**状态**: [ ] 未开始

| 步骤 | 操作 | 预期结果 | 状态 |
|------|------|----------|------|
| 4.1 | Run 详情页点击「创建 FAI」| FAI 创建成功 | [ ] |
| 4.2 | 进入 /mes/fai 点击「开始」| FAI 状态变为 INSPECTING | [ ] |
| 4.3 | 在执行页面完成试产过站 | TrackIn/TrackOut 成功 | [ ] |
| 4.4 | 回到 /mes/fai 完成检验 | FAI 状态变为 PASS | [ ] |

### 阶段 5：Run 授权 (2.5)
**页面**: `/mes/runs/{runNo}`
**状态**: [ ] 未开始

| 步骤 | 操作 | 预期结果 | 状态 |
|------|------|----------|------|
| 5.1 | 点击「授权生产」| Run 状态变为 AUTHORIZED | [ ] |

### 阶段 6：批量执行 (2.6)
**页面**: `/mes/execution`
**状态**: [ ] 未开始

| 步骤 | 操作 | 预期结果 | 状态 |
|------|------|----------|------|
| 6.1 | 选择工位 ST-SPI-01 | 工位信息加载 | [ ] |
| 6.2 | 完成 TrackIn | 进站成功 | [ ] |
| 6.3 | 完成 TrackOut (PASS) | 出站成功 | [ ] |
| 6.4 | 依次完成 ST-MOUNT-01, ST-REFLOW-01, ST-AOI-01 | Unit 状态变为 DONE | [ ] |

### 阶段 7：收尾与 OQC (2.7)
**页面**: `/mes/runs/{runNo}` + `/mes/oqc`
**状态**: [ ] 未开始

| 步骤 | 操作 | 预期结果 | 状态 |
|------|------|----------|------|
| 7.1 | Run 详情页点击「收尾」| 提示需要 OQC 或直接完成 | [ ] |
| 7.2 | 若需要 OQC，完成 OQC 检验 | OQC 状态变为 PASS | [ ] |
| 7.3 | 再次点击「收尾」| Run 状态变为 COMPLETED | [ ] |

### 阶段 8：追溯验证 (2.8)
**页面**: `/mes/trace`
**状态**: [ ] 未开始

| 步骤 | 操作 | 预期结果 | 状态 |
|------|------|----------|------|
| 8.1 | 输入生产的 SN | 显示追溯信息 | [ ] |
| 8.2 | 检查路由版本快照 | 显示正确的路由信息 | [ ] |
| 8.3 | 检查过站记录 | 显示所有 TrackIn/Out 记录 | [ ] |
| 8.4 | 检查检验记录 | 显示 FAI/OQC 信息 | [ ] |

---

## 验收账号

| 阶段 | 推荐账号 | 密码 |
|------|----------|------|
| 工单下发 | planner@example.com | Test123! |
| Readiness/执行 | leader@example.com | Test123! |
| FAI/OQC | quality@example.com | Test123! |
| 追溯 | 任意登录用户 | - |

---

## 验证成功标准

- [ ] SMT 全流程闭环完成（工单→批次→过站→追溯）
- [ ] 所有关键页面可正常访问和操作
- [ ] 状态转换符合预期
- [ ] 追溯信息完整准确
- [ ] 无阻断性 Bug

---

## 文件引用

- 演示指南: `user_docs/demo/guide.md`
- 问题记录: `user_docs/demo/acceptance_issues.md`
