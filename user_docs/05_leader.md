# 产线组长 (Leader) 操作指南

## 角色概述

产线组长负责产线的日常运营管理，包括批次授权、生产监控、人员调度和现场问题处理。

| 属性 | 值 |
|------|-----|
| 角色代码 | `leader` |
| 数据范围 | 分配的产线 (ASSIGNED_LINES) |
| 默认首页 | `/mes/runs` |

## 权限清单

### 批次管理
- ✓ 查看批次 (`run:read`)
- ✓ 创建批次 (`run:create`)
- ✓ 授权批次 (`run:authorize`)
- ✓ 撤销授权 (`run:revoke`)
- ✓ 关闭批次 (`run:close`)

### 工位执行
- ✓ 查看执行 (`exec:read`)
- ✓ 进站操作 (`exec:track_in`)
- ✓ 出站操作 (`exec:track_out`)
- ✓ 数据采集 (`exec:data_collect`)

### 其他
- ✓ 查看工单 (`wo:read`)
- ✓ 查看路由 (`route:read`)
- ✓ 追溯查询 (`trace:read`)

## 可访问菜单

```
生产执行
├── 工单管理      /mes/work-orders     [只读]
├── 批次管理      /mes/runs            [完整操作]
├── 准备异常      /mes/readiness-exceptions [查看]
├── 工位执行      /mes/execution       [完整操作]
├── 路由管理      /mes/routes          [只读]
├── 路由版本      /mes/route-versions  [只读]
└── 追溯查询      /mes/trace           [只读]

通知中心          /notifications
```

> **注意**: 产线组长只能看到其绑定产线下的数据。

---

## 核心功能操作

### 1. 批次管理

#### 1.1 查看批次列表
1. 导航至 **生产执行 → 批次管理**
2. 查看所负责产线的批次
3. 使用筛选条件：
   - 批次状态
   - 所属工单
   - 日期范围

#### 1.2 授权批次
计划员创建批次后，组长需要授权才能开始生产：

1. 找到状态为 **待授权** 的批次
2. 点击 **授权** 按钮
3. 检查授权条件：
   - 路由版本有效
   - 准备检查通过（或已豁免）
   - 资源就绪
4. 确认授权

> **说明**: 授权后批次状态变为 **已授权**，操作员可以开始进站操作。

#### 1.3 创建批次
组长也可以在已发布的工单下创建批次：
1. 点击 **新建批次**
2. 选择工单
3. 填写批次信息：
   - 批次数量
   - 序列号范围
   - 备注
4. 保存后可直接授权

#### 1.4 撤销授权
需要暂停生产时：
1. 选择已授权的批次
2. 点击 **撤销授权**
3. 填写撤销原因
4. 确认撤销

> **注意**: 已有在制产品的批次，撤销后在制产品仍需完成当前工序。

#### 1.5 关闭批次
批次完成后：
1. 确认所有产品完成或已处置
2. 点击 **关闭批次**
3. 确认关闭

---

### 2. 工位执行

#### 2.1 工位监控
1. 导航至 **生产执行 → 工位执行**
2. 查看各工位状态：
   - 当前在制产品
   - 操作员
   - 等待时间
   - 异常情况

#### 2.2 代操作
组长可以代替操作员执行进站/出站：

**进站操作**
1. 选择工位
2. 扫描或输入产品序列号
3. 确认进站

**出站操作**
1. 选择在制产品
2. 完成数据采集（如需要）
3. 确认出站

#### 2.3 异常处理
当操作员遇到问题时：
1. 查看异常详情
2. 做出处理决定：
   - 协助解决继续生产
   - 上报质量问题
   - 暂停生产等待处理

---

### 3. 就绪检查管理

批次授权前，系统会进行就绪检查，确保生产条件满足。

#### 3.1 就绪检查项

| 检查项 | 说明 | 数据来源 |
|--------|------|----------|
| **钢网就绪** | 钢网张力合格、已清洗 | 自动(TPM)/手动录入 |
| **锡膏合规** | 锡膏在有效期内、已回温搅拌 | 自动(WMS)/手动录入 |
| **物料备料** | 物料已备齐、标签SN范围正确 | 手动确认 |
| **设备就绪** | 贴片程序已加载、参数已设置 | 手动确认 |

#### 3.2 查看就绪检查结果
1. 在批次详情中查看准备检查状态
2. 查看各检查项结果：
   - ✅ 通过
   - ❌ 未通过（显示失败原因）
   - ⏳ 待检查
3. 查看数据来源标识：
   - `AUTO`: 自动从外部系统获取
   - `MANUAL`: 人工手动录入

#### 3.3 手动录入检查结果（降级模式）

当外部系统（TPM/WMS）不可用时，可手动录入：

1. 点击检查项旁的 **手动录入** 按钮
2. 填写确认信息：
   - 钢网：钢网编号 + 确认状态（READY/NOT_READY）
   - 锡膏：批次号 + 确认状态（COMPLIANT/NON_COMPLIANT）
3. 确认提交

> **注意**: 手动录入的数据会标记 `source: MANUAL`，用于审计追溯。

#### 3.4 查看准备异常
1. 导航至 **生产执行 → 准备异常**
2. 查看所负责产线的异常项
3. 点击异常项可跳转到对应批次处理

> **说明**: 准备检查的豁免需要更高权限或按配置的审批流程处理。

---

### 4. 上料防错

上料防错是 SMT 产线的核心卡控环节，确保物料与 BOM 一致。

#### 4.1 上料防错流程

```
加载站位表 → 扫描站位码 → 扫描物料码 → 系统比对 → 确认绑定
```

#### 4.2 执行上料验证
1. 进入批次详情页 → **上料防错** 标签
2. 系统自动加载该批次的站位表（基于路由配置）
3. 逐站位扫码验证：
   - 扫描站位二维码
   - 扫描物料二维码
4. 系统自动比对：
   - BOM 物料 vs 实际上料
   - 正确 → 绿色 ✓，记录绑定关系
   - 错误 → 红色 ✗，报警锁定

#### 4.3 上料异常处理

| 异常情况 | 系统行为 | 处理方式 |
|----------|----------|----------|
| 物料不匹配 | 报警锁定 | 更换正确物料，重新扫码 |
| 物料过期 | 报警提示 | 更换有效期内物料 |
| 重试超过3次 | 锁定工位 | 联系工艺工程师处理 |

#### 4.4 查看上料记录
1. 在批次详情查看已绑定的物料列表
2. 每条记录显示：站位、物料编码、物料批次、绑定时间、操作员

---

### 5. 生产监控

### 5.1 实时状态查看
1. 在批次列表查看进度
2. 点击批次详情查看：
   - 完成数量 / 在制数量 / 待执行数量
   - 各工位排队情况
   - 预计完成时间

### 5.2 产能统计
1. 查看班次产量
2. 对比计划与实际
3. 分析瓶颈工位

---

## 工作流程

### 班次开始工作流

```
班次交接
    │
    ▼
查看待授权批次 ──→ 检查准备情况 ──→ 授权批次
    │
    ▼
分配人员到工位
    │
    ▼
监控生产进度
    │
    ▼
处理异常情况
    │
    ▼
班次结束 ──→ 确认批次状态 ──→ 交接
```

### 批次状态流转

```
计划员创建批次
        │
        ▼
    [PREP] 准备中
        │
        ├── 就绪检查（钢网/锡膏/物料/设备）
        ├── 上料防错验证
        │
组长授权 │
        ▼
    [AUTHORIZED] 已授权
        │
开始生产 │
        ▼
    [IN_PROGRESS] 生产中
        │
完成/处置 │
        ▼
    [COMPLETED] 已完成
```

---

## 常见场景

### 场景1: 紧急插单
1. 收到紧急批次授权请求
2. 快速检查准备情况
3. 授权批次
4. 调整人员分配，优先执行

### 场景2: 生产异常
1. 操作员报告异常
2. 查看工位状态和产品信息
3. 判断问题性质：
   - 设备问题 → 联系设备维护
   - 质量问题 → 通知质量工程师
   - 工艺问题 → 通知工艺工程师
4. 决定是否暂停该批次

### 场景3: 人员调整
1. 分析各工位负载
2. 识别瓶颈工位
3. 调整人员分配
4. 监控效果

### 场景4: 批次完成
1. 确认所有产品完成生产
2. 处理异常产品（如有）
3. 关闭批次
4. 准备下一批次

---

## 产线管理技巧

### 1. 节拍控制
- 监控各工位的处理时间
- 识别瓶颈工位并及时调整
- 保持生产节拍平衡

### 2. 问题预防
- 班前检查设备状态
- 确保物料准备充足
- 关注操作员反馈

### 3. 效率提升
- 合理安排换线时间
- 减少等待浪费
- 优化人员配置

---

## 与其他角色的协作

| 协作角色 | 协作内容 |
|----------|----------|
| 生产计划员 | 批次创建协调，进度沟通 |
| 工艺工程师 | 工艺问题反馈，作业指导 |
| 质量工程师 | 首件检验协调，质量问题处理 |
| 操作员 | 工作分配，问题指导，技能培训 |

---

## 注意事项

1. **授权前检查**: 确保所有准备工作就绪再授权
2. **及时响应**: 操作员遇到问题时快速响应
3. **数据准确**: 确保生产数据的准确性
4. **安全第一**: 发现安全隐患立即处理
5. **团队管理**: 保持团队沟通，及时解决人员问题
