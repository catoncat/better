## Context

- Reviewed newly committed work on worktree `/Users/envvar/lzb/better-3.5.2` (branch `feat/3.5.2-dc-spec-web`).
- Scope: commits `29c52e2` (3.5.3), `82ad8aa` (3.5.4), `af6bb6b` (demo seed).
- Note: `git status` shows untracked `docs/` in this worktree (not part of review).

## Decisions

- Treat the feature set as “end-to-end usable” but with correctness gaps that can block shop-floor use:
  - Server TrackOut currently enforces **all bound** `dataSpecIds` as required; UI enforces `spec.isRequired` only.
  - Server TrackOut does **not** ignore `isActive=false` specs when validating, while GET `data-specs` filters them out.
  - Web TrackOutDialog sends JSON values as `valueText` (server expects `valueJson`).
- Docs drift: `domain_docs/mes/plan/phase3_tasks.md` still shows `3.5.3` and `3.5.5` unchecked even though implementation landed.

## Plan

1. Align server TrackOut validation rules with UI + spec (`isRequired` + `isActive`).
2. Fix TrackOutDialog JSON handling (parse to object and send `valueJson`).
3. Decide RBAC model for data collection: use `EXEC_TRACK_OUT` only vs enforce `EXEC_DATA_COLLECT`.
4. Update `domain_docs/mes/plan/phase3_tasks.md` checkboxes (or explicitly defer subtasks like 3.5.3.3).

## Open Questions

- What is the intended contract of `step.dataSpecIds`?
  - “Specs to display, requiredness comes from `spec.isRequired`” (recommended), or
  - “All selected specs are required” (then `isRequired` becomes mainly display-only).
- Should TrackOut allow FAIL via the “报不良” shortcut without data collection, or should it route into the same data-collection dialog?
- Should compile validate that `dataSpecIds` belong to the step’s `operationId` (guard against cross-operation binding)?

## References

- `apps/web/src/routes/_authenticated/mes/-components/data-spec-selector.tsx`
- `apps/web/src/routes/_authenticated/mes/routes/$routingCode.tsx`
- `apps/server/src/modules/mes/routing/service.ts`
- `apps/server/src/modules/mes/execution/service.ts`
- `apps/server/src/modules/mes/execution/schema.ts`
- `apps/web/src/routes/_authenticated/mes/-components/track-out-dialog.tsx`
- `apps/server/scripts/seed-dc-demo.ts`
- `domain_docs/mes/plan/phase3_tasks.md`
