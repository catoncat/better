# Login Navigation Fix

## Issue
Users reported that after clicking login, the URL changes (e.g. to `/mes/work-orders`) but the page content remains on the Login page.

## Root Cause
The `LoginForm` component was calling `queryClient.removeQueries({ queryKey: sessionQueryKey })` on success, immediately followed by `router.navigate()`. 
The `_authenticated` route's `beforeLoad` guard checks the session cache. Because the cache was cleared, it triggered a fetch. If this fetch had any race condition or latency vs the navigation state, or if the router matched before the fetch completed, it could lead to an inconsistent state or a redirect loop back to login (which might explain the "stay on login page" behavior).

## Fix
Updated `LoginForm` to explicitly **prefetch** the session using `queryClient.fetchQuery` and await it *before* navigating.
```typescript
await queryClient.fetchQuery({
    queryKey: sessionQueryKey,
    queryFn: () => authClient.getSession(),
    staleTime: 0,
});
router.navigate({ to: "/mes/work-orders" });
```
This ensures the session is fresh and available in the cache when the protected route's `beforeLoad` runs, allowing it to pass the check synchronously (or via immediate cache hit) and render the protected content.
