# mes-plan_m3

## Context
- User request: do not implement now; produce a solid M3 plan aligned with repo workflow (plan-first, checkbox tracking, small-step commits).
- Observation: core SMT/DIP nodes are mapped in `impl_align`, but “上线可用” still needs repeatable acceptance, ops/runbooks, and docs consistency.

## Decisions
- Re-scope M3 to **Go-Live Readiness** (acceptance + ops + docs + real-data smoke), and treat M4 as post go-live automation/ingest/outbound.
- Make `domain_docs/mes/plan/phase3_tasks.md` the **single progress tracker** for M3.
- Confirmed go-live boundary:
  - Manual TrackIn/TrackOut is acceptable for go-live.
  - External integrations (including TPM) can run in degraded/manual mode for go-live.
  - Data collection configuration must be completed (DataCollectionSpec CRUD + UI + binding).

## Plan
- Canonical plan doc: `domain_docs/mes/plan/phase3_tasks.md`
- Tracks (parallelizable):
  - Track A (P0): Docs & Contract Alignment
    - 3.1.1 Re-define M3/M4 scope across docs
    - 3.1.2 Fix acceptance scenarios/API drift (esp. data collection + trace)
    - 3.1.3 Mark/update stale gap reports to avoid progress misread
  - Track B (P0): E2E Demo & Seed Hardening
    - 3.2.1 Seed covers SMT + DIP minimum master data + READY route versions
    - 3.2.2 Demo script covers gates + QC loop + closeout + trace validation
    - 3.2.3 Turn demo script into selectable, repeatable acceptance script
  - Track C (P0): Ops & Deployment Readiness
    - 3.3.1 Single-binary deployment checklist/runbook
    - 3.3.2 SQLite backup/restore/upgrade SOP
    - 3.3.3 Observability + audit minimum configuration/runbook
  - Track D (P1): UX & Training
    - 3.4.1 Role-based SOP (planner/engineer/quality/leader/operator)
    - 3.4.2 On-site demo talk-track (10–20min) + failure branch
    - 3.4.3 UX polish backlog, only P1 blockers
  - Track E (P2 optional): Data collection configuration UX
    - 3.5.1 Decide seed-only vs CRUD+UI
    - 3.5.2 If UI, replace manual `dataSpecIds` input with selector
- Workflow policy:
  - Update checkboxes in `domain_docs/mes/plan/phase3_tasks.md` as the only M3 progress signal.
  - One minimal closed-loop per commit (docs / seed+script / ops / ux), avoid one giant PR.
  - Scope/task changes: update plan first, then code; write a conversation note for decisions.
  - Pre-merge: run `bun run lint` and `bun run check-types` on the worktree to merge.
- Suggested checkpoints:
  - CP0 scope freeze: 3.1.1 + 3.1.2
  - CP1 acceptance-ready: 3.2.1~3.2.3
  - CP2 deploy/rollback-ready: 3.3.1~3.3.2
  - CP3 delivery-ready: 3.4.1~3.4.2 (+ only P1 blockers from 3.4.3)

## Open Questions
- Which integrations we will still smoke-test in staging/sandbox for M3 (even though go-live allows degrade): TPM/WMS/SPI/AOI?
- Data collection scope for M3: only MANUAL TrackOut data entry, or also any AUTO parsing path?

## References
- `domain_docs/mes/plan/phase3_tasks.md`
- `domain_docs/mes/plan/01_milestones.md`
- `domain_docs/mes/plan/tasks.md.md`
- `domain_docs/mes/tests/01_acceptance_scenarios.md`
- `apps/server/scripts/test-mes-flow.ts`
