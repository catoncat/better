# mes-next_triage

## Context
- User asked for MES "what's next" triage.
- Repo: `/Users/envvar/lzb/better`
- Branch: `main` (`ahead 1` vs `origin/main`)

## Decisions
- Not implementing yet; persist the triage into the doc system as a draft Phase 4 plan and link it from the MES docs index/milestones.
- Current urgent focus (pre-M4): run full-flow UI acceptance (frontend integration) per `user_docs/demo/acceptance_plan.md` and track issues in `user_docs/demo/acceptance_issues.md`.
- Outbound feedback scope remains TBD (kept as an optional track in the Phase 4 plan).

## Plan
- Read `domain_docs/mes/plan/phase3_tasks.md` (current work breakdown).
- Shortlist 3-5 `[ ]` / `[~]` items and group into 2-4 parallel tracks.
- Call out shared-touch conflicts and ask user to pick one track/item.
- Before any Phase 4 implementation: execute the acceptance plan and close/triage P0 blockers.

## Findings
- Worktree scan: no in-flight worktrees.
- `domain_docs/mes/plan/phase3_tasks.md`: M3 marked DONE (all tracks completed).
- `domain_docs/mes/plan/01_milestones.md`: M1~M3 marked DONE; M4 is in planning (now has a draft plan file).
- `domain_docs/mes/plan/tasks.md.md`: overall DONE; a few optional gaps noted (e.g. readiness config page).
- Acceptance artifacts exist under `user_docs/demo/` for UI + frontend integration verification.

## Progress
- Preflight complete (git status, worktree scan).
- Drafted `domain_docs/mes/plan/phase4_tasks.md` from this triage output.
- Updated `domain_docs/mes/CONTEXT.md` and `domain_docs/mes/plan/01_milestones.md` to point to the Phase 4 plan.
- Updated the same docs to point the urgent “what now” to the UI acceptance plan/issues tracker.

## Errors
- None

## Open Questions
- Are we treating acceptance as a strict gate (no new feature dev until green), or allowing parallel fixes/cleanups while acceptance is in progress?

## References
- `domain_docs/mes/CONTEXT.md`
- `domain_docs/mes/plan/01_milestones.md`
- `domain_docs/mes/plan/tasks.md.md`
- `domain_docs/mes/plan/phase3_tasks.md`
- `domain_docs/mes/plan/phase4_tasks.md`
- `user_docs/demo/acceptance_plan.md`
- `user_docs/demo/acceptance_issues.md`

## Triage Output

Worktree Scan:
- Current: `/Users/envvar/lzb/better` (`main`)
- In-flight worktrees: none

- Track A: M4 planning & acceptance (plan additions)
  - Candidates:
    - Define `domain_docs/mes/plan/phase4_tasks.md`: why now M1~M3 are DONE but M4 is “pending planning”; depends on confirm M4 scope (AUTO/BATCH/TEST ingest vs outbound feedback); touch points `domain_docs/mes/plan/01_milestones.md`, `domain_docs/mes/spec/routing/01_routing_engine.md`, `domain_docs/mes/spec/routing/03_route_execution_config.md`, `domain_docs/mes/tests/*`

- Track B: Ingest event foundation (backend) (M4)
  - Candidates:
    - Add ingest event model + idempotent API: why now required for AUTO/BATCH/TEST execution; depends on Track A for event schema + dedupe keys; touch points `packages/db/prisma/schema/schema.prisma`, `apps/server/src/modules/mes/routing/service.ts`, `apps/server/src/modules/mes/execution/service.ts`, `apps/server/src/modules/mes/trace/*`

- Track C: AUTO/TEST execution via `ingestMapping` (M4)
  - Candidates:
    - Implement AUTO/TEST ingest → Tracks/DataValues/outcome: why now unlock equipment + test integration; depends on Track B (ingest persistence + API) and existing compile validation for `ingestMapping`; touch points `apps/server/src/modules/mes/execution/service.ts`, `apps/server/src/modules/mes/routing/service.ts`, `domain_docs/mes/spec/routing/01_routing_engine.md`, `domain_docs/mes/spec/traceability/01_traceability_contract.md`

- Track D: Ops/UX gap (optional)
  - Candidates:
    - Readiness check config UI/API: why now called out as an unimplemented gap in Phase 2; depends on whether you want configurable readiness before scaling automation; touch points `domain_docs/mes/plan/tasks.md.md`, `apps/server/src/modules/mes/readiness/*`, `apps/web/src/routes/_authenticated/mes/*`

- Conflicts:
  - Track B blocks Track C: Track C needs ingest storage/API and shares touch points (`execution/service.ts`, `routing/service.ts`).
  - Track A influences Track B/C: the ingest contract (event shape + dedupe keys) affects DB/API design.

Pick one; I will confirm scope and start plan-first implementation. Also: do you want a dedicated worktree for the chosen item?
