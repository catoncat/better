# smt-time-rule-fix

## Context
- Fix SMT time-rule management per review: definition code mismatches, schema validation gaps, UI `any` lint errors.

## Decisions
- Align default rule codes to runtime references (`SOLDER_PASTE_24H`, `WASH_4H`).
- Normalize event placeholders to known audit actions (`SOLDER_PASTE_USAGE_CREATE`, `TRACK_OUT`, `TRACK_IN`).
- Allow `description: null` in time-rule schema to support clearing from UI.
- Expand list sortBy schema to include fields surfaced in UI columns.
- Update MES config templates/samples to match new rule codes/events/scope enum.

## Plan
- Update seed scripts to use aligned codes/events.
- Update time-rule schema (description nullable + sortBy union).
- Remove `any` from time-rule dialog/hooks; align types to Eden API.
- Update MES config templates/samples to reflect rule codes/events.
- Run `bun scripts/smart-verify.ts`.

## Findings
- Runtime uses definitionCode `SOLDER_PASTE_24H`/`WASH_4H` while seed-mes used `SOLDER_PASTE_EXPOSURE`/`WASH_TIME_WINDOW`.
- UI dialog used `any` and sent `description: null` while schema only allowed string/undefined.
- UI sortable columns exceeded allowed `sortBy` values.

## Progress
- Seed scripts aligned to runtime codes and normalized event placeholders.
- Schema updated for nullable description and broader sortBy.
- Time rule dialog/hooks refactored to remove `any` and use Eden-derived types.
- Config template/sample updated to new codes/events/scope enum.

## Errors
- None.

## Open Questions
- Confirm whether `TRACK_OUT`/`TRACK_IN` placeholders match actual event naming; adjust if event emitter uses a different code format.

## References
- `apps/server/scripts/seed-mes.ts`
- `apps/server/scripts/seed-time-rules.ts`
- `apps/server/src/modules/mes/time-rule/schema.ts`
- `apps/web/src/routes/_authenticated/mes/time-rules/-components/time-rule-dialog.tsx`
- `apps/web/src/hooks/use-time-rules.ts`
- `domain_docs/mes/spec/config/templates/time_rule_config.template.yaml`
- `domain_docs/mes/spec/config/samples/smt_a_time_rule_config.yaml`
