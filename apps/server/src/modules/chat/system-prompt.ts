/**
 * System prompt generator for the AI chat assistant
 * Generates context-aware prompts based on the current page route
 */

// Route to page context mapping
const routeContextMap: Record<string, { name: string; description: string; actions: string[] }> = {
	"/": {
		name: "ä»ªè¡¨ç›˜",
		description: "ç³»ç»Ÿé¦–é¡µï¼Œå±•ç¤ºå…³é”®æŒ‡æ ‡å’Œå¿«æ·å…¥å£",
		actions: ["æŸ¥çœ‹ç”Ÿäº§æ¦‚è§ˆ", "å¿«é€Ÿå¯¼èˆªåˆ°å„åŠŸèƒ½æ¨¡å—"],
	},
	"/mes/runs/$runNo": {
		name: "ç”Ÿäº§æ‰¹æ¬¡è¯¦æƒ…",
		description: "æŸ¥çœ‹ç”Ÿäº§æ‰¹æ¬¡è¯¦æƒ…ä¸æ‰§è¡Œè®°å½•",
		actions: ["æŸ¥çœ‹æ‰¹æ¬¡è¯¦æƒ…", "æŸ¥çœ‹è¿‡ç«™è®°å½•", "è¿”å›æ‰¹æ¬¡åˆ—è¡¨"],
	},
	"/mes/routes/$routingCode": {
		name: "è·¯ç”±è¯¦æƒ…",
		description: "æŸ¥çœ‹è·¯ç”±æ­¥éª¤ä¸ç‰ˆæœ¬ä¿¡æ¯",
		actions: ["æŸ¥çœ‹è·¯ç”±è¯¦æƒ…", "æŸ¥çœ‹æ­¥éª¤é…ç½®", "è¿”å›è·¯ç”±åˆ—è¡¨"],
	},
	"/mes/loading/slot-config": {
		name: "ç«™ä½è¡¨é…ç½®",
		description: "é…ç½®ä¸Šæ–™ç«™ä½è¡¨ä¸æ˜ å°„å…³ç³»",
		actions: ["æŸ¥çœ‹ç«™ä½è¡¨", "æ–°å¢/ç¼–è¾‘æ˜ å°„", "ä¿å­˜é…ç½®"],
	},
	"/mes/oqc/rules": {
		name: "OQC è§„åˆ™",
		description: "ç®¡ç†å‡ºè´§æ£€éªŒè§„åˆ™ä¸åˆ¤å®šæ ‡å‡†",
		actions: ["æŸ¥çœ‹è§„åˆ™åˆ—è¡¨", "æ–°å¢è§„åˆ™", "ç¼–è¾‘è§„åˆ™"],
	},
	"/mes/integration/status": {
		name: "é›†æˆçŠ¶æ€ç›‘æ§",
		description: "æŸ¥çœ‹ç³»ç»Ÿé›†æˆçŠ¶æ€ä¸å¥åº·æƒ…å†µ",
		actions: ["æŸ¥çœ‹é›†æˆçŠ¶æ€", "ç­›é€‰å¼‚å¸¸", "æŸ¥çœ‹è¯¦æƒ…"],
	},
	"/mes/integration/device-data": {
		name: "è®¾å¤‡æ•°é‡‡",
		description: "æŸ¥çœ‹è®¾å¤‡æ•°æ®é‡‡é›†ä¸ä¸ŠæŠ¥æƒ…å†µ",
		actions: ["æŸ¥çœ‹æ•°é‡‡åˆ—è¡¨", "ç­›é€‰æ•°æ®", "æŸ¥çœ‹è¯¦æƒ…"],
	},
	"/mes/integration/manual-entry": {
		name: "è€—æçŠ¶æ€å½•å…¥",
		description: "æ‰‹åŠ¨å½•å…¥ä¸ç»´æŠ¤è€—æçŠ¶æ€",
		actions: ["æŸ¥çœ‹è€—æåˆ—è¡¨", "å½•å…¥çŠ¶æ€", "æŸ¥çœ‹è®°å½•"],
	},
	"/mes/work-orders": {
		name: "å·¥å•ç®¡ç†",
		description: "ç®¡ç†ç”Ÿäº§å·¥å•ï¼ŒåŒ…æ‹¬åˆ›å»ºã€æŸ¥çœ‹ã€ç¼–è¾‘å·¥å•ä¿¡æ¯",
		actions: ["æŸ¥çœ‹å·¥å•åˆ—è¡¨", "ä¸‹å‘å·¥å•åˆ°äº§çº¿", "åˆ›å»ºæ‰¹æ¬¡ (Run)", "æ”¶å°¾å·¥å•"],
	},
	"/mes/runs": {
		name: "ç”Ÿäº§æ‰¹æ¬¡ç®¡ç†",
		description: "ç®¡ç†ç”Ÿäº§æ‰¹æ¬¡ (Run)ï¼Œè¿½è¸ªç”Ÿäº§è¿›åº¦",
		actions: ["æŸ¥çœ‹æ‰¹æ¬¡åˆ—è¡¨", "åˆ›å»ºç”Ÿäº§æ‰¹æ¬¡", "æˆæƒç”Ÿäº§", "æ”¶å°¾æ‰¹æ¬¡"],
	},
	"/mes/bake-records": {
		name: "çƒ˜çƒ¤è®°å½•",
		description: "æŸ¥çœ‹çƒ˜çƒ¤è®°å½•ä¸è¿½è¸ªä¿¡æ¯",
		actions: ["æŸ¥çœ‹è®°å½•åˆ—è¡¨", "ç­›é€‰è®°å½•", "æŸ¥çœ‹è¯¦æƒ…"],
	},
	"/mes/solder-paste-usage": {
		name: "é”¡è†ä½¿ç”¨è®°å½•",
		description: "æŸ¥çœ‹é”¡è†ä½¿ç”¨ä¸è¿½è¸ªè®°å½•",
		actions: ["æŸ¥çœ‹è®°å½•åˆ—è¡¨", "ç­›é€‰è®°å½•", "æŸ¥çœ‹è¯¦æƒ…"],
	},
	"/mes/cold-storage-temperatures": {
		name: "å†·è—æ¸©åº¦è®°å½•",
		description: "æŸ¥çœ‹å†·è—æ¸©åº¦è®°å½•ä¸å¼‚å¸¸æƒ…å†µ",
		actions: ["æŸ¥çœ‹è®°å½•åˆ—è¡¨", "ç­›é€‰è®°å½•", "æŸ¥çœ‹è¯¦æƒ…"],
	},
	"/mes/stencil-usage": {
		name: "é’¢ç½‘ä½¿ç”¨è®°å½•",
		description: "æŸ¥çœ‹é’¢ç½‘ä½¿ç”¨æƒ…å†µä¸è®°å½•",
		actions: ["æŸ¥çœ‹è®°å½•åˆ—è¡¨", "ç­›é€‰è®°å½•", "æŸ¥çœ‹è¯¦æƒ…"],
	},
	"/mes/stencil-cleaning": {
		name: "é’¢ç½‘æ¸…æ´—è®°å½•",
		description: "æŸ¥çœ‹é’¢ç½‘æ¸…æ´—è®°å½•ä¸æ˜ç»†",
		actions: ["æŸ¥çœ‹è®°å½•åˆ—è¡¨", "ç­›é€‰è®°å½•", "æŸ¥çœ‹è¯¦æƒ…"],
	},
	"/mes/squeegee-usage": {
		name: "åˆ®åˆ€ä½¿ç”¨è®°å½•",
		description: "æŸ¥çœ‹åˆ®åˆ€ä½¿ç”¨è®°å½•ä¸å¯¿å‘½",
		actions: ["æŸ¥çœ‹è®°å½•åˆ—è¡¨", "ç­›é€‰è®°å½•", "æŸ¥çœ‹è¯¦æƒ…"],
	},
	"/mes/equipment-inspections": {
		name: "è®¾å¤‡ç‚¹æ£€è®°å½•",
		description: "æŸ¥çœ‹è®¾å¤‡ç‚¹æ£€è®°å½•ä¸å¼‚å¸¸",
		actions: ["æŸ¥çœ‹è®°å½•åˆ—è¡¨", "ç­›é€‰è®°å½•", "æŸ¥çœ‹è¯¦æƒ…"],
	},
	"/mes/oven-program-records": {
		name: "ç‚‰æ¸©ç¨‹å¼è®°å½•",
		description: "æŸ¥çœ‹ç‚‰æ¸©ç¨‹å¼è®°å½•ä¸çŠ¶æ€",
		actions: ["æŸ¥çœ‹è®°å½•åˆ—è¡¨", "ç­›é€‰è®°å½•", "æŸ¥çœ‹è¯¦æƒ…"],
	},
	"/mes/maintenance-records": {
		name: "ç»´ä¿®è®°å½•",
		description: "æŸ¥çœ‹è®¾å¤‡ç»´ä¿®è®°å½•ä¸å¤„ç†æƒ…å†µ",
		actions: ["æŸ¥çœ‹è®°å½•åˆ—è¡¨", "ç­›é€‰è®°å½•", "æŸ¥çœ‹è¯¦æƒ…"],
	},
	"/mes/readiness-exceptions": {
		name: "å‡†å¤‡å¼‚å¸¸",
		description: "å¤„ç†å‡†å¤‡å¼‚å¸¸ä¸çŠ¶æ€è·Ÿè¿›",
		actions: ["æŸ¥çœ‹å¼‚å¸¸åˆ—è¡¨", "ç­›é€‰å¼‚å¸¸", "æŸ¥çœ‹è¯¦æƒ…"],
	},
	"/mes/readiness-config": {
		name: "å‡†å¤‡æ£€æŸ¥é…ç½®",
		description: "é…ç½®å‡†å¤‡æ£€æŸ¥è§„åˆ™ä¸é¡¹",
		actions: ["æŸ¥çœ‹é…ç½®", "ç¼–è¾‘é…ç½®", "ä¿å­˜é…ç½®"],
	},
	"/mes/time-rules": {
		name: "æ—¶é—´è§„åˆ™ç®¡ç†",
		description: "é…ç½®æ—¶é—´è§„åˆ™ä¸æœ‰æ•ˆæœŸè®¾ç½®",
		actions: ["æŸ¥çœ‹è§„åˆ™", "ç¼–è¾‘è§„åˆ™", "ä¿å­˜è§„åˆ™"],
	},
	"/mes/loading": {
		name: "ä¸Šæ–™éªŒè¯",
		description: "SMT/DIP äº§çº¿ä¸Šæ–™éªŒè¯ï¼Œç¡®ä¿æ­£ç¡®ç‰©æ–™ä¸Šåˆ°æ­£ç¡®ä½ç½®",
		actions: ["åŠ è½½ç«™ä½è¡¨", "æ‰«ææ§½ä½æ¡ç ", "æ‰«æç‰©æ–™æ¡ç ", "éªŒè¯ç‰©æ–™åŒ¹é…", "æ¢æ–™", "è§£é”ç«™ä½"],
	},
	"/mes/fai": {
		name: "é¦–ä»¶æ£€éªŒ (FAI)",
		description: "é¦–ä»¶æ£€éªŒé¡µé¢ï¼Œå¯¹ç”Ÿäº§é¦–ä»¶è¿›è¡Œè´¨é‡æ£€éªŒ",
		actions: ["åˆ›å»º FAI", "å¯åŠ¨æ£€éªŒ", "è®°å½•æ£€éªŒé¡¹", "åˆ¤å®š PASS/FAIL", "ç­¾å­—ç¡®è®¤"],
	},
	"/mes/fqc": {
		name: "æœ«ä»¶æ£€éªŒ",
		description: "æœ«ä»¶æ£€éªŒé¡µé¢ï¼Œå®Œæˆæ‰¹æ¬¡æœ«ä»¶è´¨é‡æ£€éªŒ",
		actions: ["æŸ¥çœ‹æ£€éªŒåˆ—è¡¨", "å¯åŠ¨æ£€éªŒ", "åˆ¤å®š PASS/FAIL"],
	},
	"/mes/execution": {
		name: "å·¥ä½æ‰§è¡Œ",
		description: "å·¥ä½çº§åˆ«çš„ç”Ÿäº§æ‰§è¡Œï¼ŒåŒ…æ‹¬æ‰«æã€æ•°æ®é‡‡é›†ã€å¼‚å¸¸å¤„ç†",
		actions: ["é€‰æ‹©å·¥ä½", "TrackIn è¿›ç«™", "å¡«å†™æ•°æ®é‡‡é›†é¡¹", "TrackOut å‡ºç«™"],
	},
	"/mes/routes": {
		name: "ç”Ÿäº§è·¯ç”±ç®¡ç†",
		description: "å®šä¹‰å’Œç®¡ç†äº§å“çš„ç”Ÿäº§è·¯ç”±ï¼ˆå·¥è‰ºæµç¨‹ï¼‰",
		actions: ["æŸ¥çœ‹è·¯ç”±åˆ—è¡¨", "åˆ›å»ºæ–°è·¯ç”±", "ç¼–è¾‘è·¯ç”±æ­¥éª¤", "å‘å¸ƒè·¯ç”±ç‰ˆæœ¬"],
	},
	"/mes/route-versions": {
		name: "è·¯ç”±ç‰ˆæœ¬",
		description: "æŸ¥çœ‹è·¯ç”±ç‰ˆæœ¬ä¸å‘å¸ƒæƒ…å†µ",
		actions: ["æŸ¥çœ‹ç‰ˆæœ¬åˆ—è¡¨", "ç­›é€‰ç‰ˆæœ¬", "æŸ¥çœ‹è¯¦æƒ…"],
	},
	"/mes/data-collection-specs": {
		name: "é‡‡é›†é¡¹ç®¡ç†",
		description: "ç®¡ç†å·¥ä½æ•°æ®é‡‡é›†é¡¹ä¸è§„åˆ™",
		actions: ["æŸ¥çœ‹é‡‡é›†é¡¹åˆ—è¡¨", "æ–°å¢é‡‡é›†é¡¹", "ç¼–è¾‘é‡‡é›†é¡¹"],
	},
	"/mes/lines": {
		name: "äº§çº¿ç®¡ç†",
		description: "ç®¡ç†ç”Ÿäº§çº¿é…ç½®ï¼ŒåŒ…æ‹¬å·¥ä½è®¾ç½®",
		actions: ["æŸ¥çœ‹äº§çº¿åˆ—è¡¨", "é…ç½®äº§çº¿", "ç®¡ç†å·¥ä½"],
	},
	"/mes/materials": {
		name: "ç‰©æ–™ç®¡ç†",
		description: "ç®¡ç†ç‰©æ–™ä¸»æ•°æ®å’Œåº“å­˜ä¿¡æ¯",
		actions: ["æŸ¥çœ‹ç‰©æ–™åˆ—è¡¨", "æœç´¢ç‰©æ–™", "æŸ¥çœ‹ç‰©æ–™è¯¦æƒ…"],
	},
	"/mes/material-lots": {
		name: "ç‰©æ–™æ‰¹æ¬¡",
		description: "æŸ¥çœ‹ç‰©æ–™æ‰¹æ¬¡ä¸è¿½è¸ªä¿¡æ¯",
		actions: ["æŸ¥çœ‹æ‰¹æ¬¡åˆ—è¡¨", "ç­›é€‰æ‰¹æ¬¡", "æŸ¥çœ‹è¯¦æƒ…"],
	},
	"/mes/boms": {
		name: "BOM",
		description: "ç®¡ç†äº§å“ BOM ç»“æ„ä¸ç‰©æ–™æ¸…å•",
		actions: ["æŸ¥çœ‹ BOM åˆ—è¡¨", "æŸ¥çœ‹ BOM è¯¦æƒ…", "ç­›é€‰ BOM"],
	},
	"/mes/work-centers": {
		name: "å·¥ä½œä¸­å¿ƒ",
		description: "ç®¡ç†å·¥ä½œä¸­å¿ƒä¸äº§çº¿èµ„æº",
		actions: ["æŸ¥çœ‹å·¥ä½œä¸­å¿ƒ", "ç¼–è¾‘é…ç½®", "æŸ¥çœ‹è¯¦æƒ…"],
	},
	"/mes/products": {
		name: "äº§å“ç®¡ç†",
		description: "ç®¡ç†äº§å“ä¸»æ•°æ®å’Œ BOM ä¿¡æ¯",
		actions: ["æŸ¥çœ‹äº§å“åˆ—è¡¨", "åˆ›å»ºäº§å“", "ç®¡ç†äº§å“ BOM"],
	},
	"/mes/oqc": {
		name: "OQC å‡ºè´§æ£€éªŒ",
		description: "å‡ºè´§è´¨é‡æ£€éªŒï¼ŒæŠ½æ£€å¹¶åˆ¤å®šæ‰¹æ¬¡æ˜¯å¦æ”¾è¡Œ",
		actions: ["æŸ¥çœ‹ OQC åˆ—è¡¨", "å¯åŠ¨æ£€éªŒ", "åˆ¤å®š PASS/FAIL"],
	},
	"/mes/daily-qc-records": {
		name: "æ—¥å¸¸QCè®°å½•",
		description: "æŸ¥çœ‹æ—¥å¸¸è´¨é‡æ£€æŸ¥è®°å½•",
		actions: ["æŸ¥çœ‹è®°å½•åˆ—è¡¨", "ç­›é€‰è®°å½•", "æŸ¥çœ‹è¯¦æƒ…"],
	},
	"/mes/production-exception-records": {
		name: "ç”Ÿäº§å¼‚å¸¸è®°å½•",
		description: "æŸ¥çœ‹ç”Ÿäº§å¼‚å¸¸è®°å½•ä¸å¤„ç½®æƒ…å†µ",
		actions: ["æŸ¥çœ‹è®°å½•åˆ—è¡¨", "ç­›é€‰è®°å½•", "æŸ¥çœ‹è¯¦æƒ…"],
	},
	"/mes/defects": {
		name: "ç¼ºé™·ç®¡ç†",
		description: "å¤„ç†ç”Ÿäº§è¿‡ç¨‹ä¸­çš„ç¼ºé™·å’Œä¸è‰¯å“",
		actions: ["æŸ¥çœ‹ç¼ºé™·åˆ—è¡¨", "å¤„ç½®ç¼ºé™· (è¿”ä¿®/æŠ¥åºŸ/æ”¾è¡Œ)"],
	},
	"/mes/rework-tasks": {
		name: "è¿”å·¥ä»»åŠ¡",
		description: "æŸ¥çœ‹è¿”å·¥ä»»åŠ¡å¹¶è·Ÿè¿›å¤„ç†",
		actions: ["æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨", "ç­›é€‰ä»»åŠ¡", "æŸ¥çœ‹è¯¦æƒ…"],
	},
	"/mes/trace": {
		name: "è¿½æº¯æŸ¥è¯¢",
		description: "æŸ¥è¯¢äº§å“çš„å®Œæ•´ç”Ÿäº§è¿½æº¯ä¿¡æ¯",
		actions: ["è¾“å…¥ SN æŸ¥è¯¢", "æŸ¥çœ‹è¿‡ç«™è®°å½•", "æŸ¥çœ‹æ£€éªŒè®°å½•", "æŸ¥çœ‹ä¸Šæ–™è®°å½•"],
	},
	"/system/user-management": {
		name: "ç”¨æˆ·ç®¡ç†",
		description: "ç®¡ç†ç³»ç»Ÿç”¨æˆ·å’Œæƒé™",
		actions: ["æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨", "åˆ›å»ºç”¨æˆ·", "ç¼–è¾‘ç”¨æˆ·æƒé™"],
	},
	"/system/role-management": {
		name: "è§’è‰²ç®¡ç†",
		description: "ç®¡ç†ç³»ç»Ÿè§’è‰²ä¸æƒé™",
		actions: ["æŸ¥çœ‹è§’è‰²åˆ—è¡¨", "åˆ›å»ºè§’è‰²", "ç¼–è¾‘è§’è‰²æƒé™"],
	},
	"/system/audit-logs": {
		name: "å®¡è®¡æ—¥å¿—",
		description: "æŸ¥çœ‹ç³»ç»Ÿæ“ä½œæ—¥å¿—ï¼Œè¿½è¸ªç”¨æˆ·æ“ä½œ",
		actions: ["æŸ¥çœ‹æ—¥å¿—åˆ—è¡¨", "ç­›é€‰æ—¥å¿—", "å¯¼å‡ºæ—¥å¿—"],
	},
	"/system/settings": {
		name: "ç³»ç»Ÿè®¾ç½®",
		description: "é…ç½®ç³»ç»Ÿå‚æ•°å’Œé€‰é¡¹",
		actions: ["æŸ¥çœ‹é…ç½®", "ç¼–è¾‘é…ç½®", "ä¿å­˜é…ç½®"],
	},
	"/system/integrations": {
		name: "é›†æˆç®¡ç†",
		description: "ç®¡ç†ç³»ç»Ÿé›†æˆä¸é…ç½®",
		actions: ["æŸ¥çœ‹é›†æˆåˆ—è¡¨", "ç¼–è¾‘é›†æˆé…ç½®", "æŸ¥çœ‹è¯¦æƒ…"],
	},
	"/system/test-upload": {
		name: "æµ‹è¯•ä¸Šä¼ ",
		description: "æµ‹è¯•ä¸Šä¼ ä¸ç»“æœæ ¡éªŒ",
		actions: ["ä¸Šä¼ æ–‡ä»¶", "æŸ¥çœ‹ç»“æœ", "é‡æ–°ä¸Šä¼ "],
	},
	"/notifications": {
		name: "é€šçŸ¥ä¸­å¿ƒ",
		description: "æŸ¥çœ‹ç³»ç»Ÿé€šçŸ¥ä¸æ¶ˆæ¯",
		actions: ["æŸ¥çœ‹é€šçŸ¥åˆ—è¡¨", "ç­›é€‰é€šçŸ¥", "æ ‡è®°å·²è¯»"],
	},
	"/login": {
		name: "ç™»å½•",
		description: "ç™»å½•ç³»ç»Ÿ",
		actions: ["è¾“å…¥è´¦å·å¯†ç ", "ç™»å½•"],
	},
	"/profile": {
		name: "ä¸ªäººèµ„æ–™",
		description: "æŸ¥çœ‹å’Œç¼–è¾‘ä¸ªäººè´¦æˆ·ä¿¡æ¯",
		actions: ["æŸ¥çœ‹ä¸ªäººä¿¡æ¯", "ä¿®æ”¹å¯†ç "],
	},
	"/mes": {
		name: "MES æ¨¡å—",
		description: "åˆ¶é€ æ‰§è¡Œç³»ç»Ÿæ¨¡å—å…¥å£",
		actions: ["æŸ¥çœ‹æ¨¡å—å…¥å£", "é€‰æ‹©åŠŸèƒ½"],
	},
	"/system": {
		name: "ç³»ç»Ÿç®¡ç†",
		description: "ç³»ç»Ÿé…ç½®ä¸ç®¡ç†å…¥å£",
		actions: ["æŸ¥çœ‹ç³»ç»ŸåŠŸèƒ½", "é€‰æ‹©é…ç½®é¡¹"],
	},
};

function getRouteContext(path: string): { name: string; description: string; actions: string[] } {
	if (routeContextMap[path]) {
		return routeContextMap[path];
	}

	let bestMatch: { name: string; description: string; actions: string[] } | null = null;
	let bestMatchLength = 0;

	for (const [route, context] of Object.entries(routeContextMap)) {
		if (route !== "/" && path.startsWith(route)) {
			if (route.length > bestMatchLength) {
				bestMatch = context;
				bestMatchLength = route.length;
			}
		}
	}

	if (bestMatch) {
		return bestMatch;
	}
	return {
		name: "å½“å‰é¡µé¢",
		description: "MES ç³»ç»Ÿé¡µé¢",
		actions: ["è¯·æè¿°æ‚¨éœ€è¦ä»€ä¹ˆå¸®åŠ©"],
	};
}

// åµŒå…¥çš„ MES çŸ¥è¯†åº“ï¼ˆä»æ¼”ç¤ºæŒ‡å—æå–çš„å…³é”®å†…å®¹ï¼‰
const MES_KNOWLEDGE = `
## æ ¸å¿ƒæ¦‚å¿µ

### æ¡ç æ ¼å¼
- **ä¸Šæ–™æ‰«ç **: \`ç‰©æ–™ç¼–ç |æ‰¹æ¬¡å·\`ï¼Œä¾‹å¦‚ \`5212090001|LOT-20250526-001\`
- **å•ä»¶ SN**: \`SN-{runNo}-{åºå·}\`ï¼Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ
- **ç«™ä½ç **: æœºå°ç«™ä½ç¼–å·ï¼Œä¾‹å¦‚ \`2F-46\`

### Run çŠ¶æ€æµè½¬
| çŠ¶æ€ | å«ä¹‰ | è§¦å‘åœºæ™¯ |
|------|------|----------|
| PREP | å‡†å¤‡ä¸­ | åˆ›å»º Run |
| AUTHORIZED | å·²æˆæƒ | æˆæƒæˆåŠŸ |
| IN_PROGRESS | æ‰§è¡Œä¸­ | é¦–æ¬¡ TrackIn |
| ON_HOLD | æš‚åœ | OQC FAIL |
| COMPLETED | å®Œå·¥ | OQC PASS |

### Unit çŠ¶æ€æµè½¬
| çŠ¶æ€ | å«ä¹‰ | è§¦å‘åœºæ™¯ |
|------|------|----------|
| QUEUED | å·²ç”Ÿæˆ | ç”Ÿæˆå•ä»¶ |
| IN_STATION | åœ¨ç«™ | TrackIn |
| DONE | å®Œæˆ | TrackOut PASS |
| OUT_FAILED | å¤±è´¥ | TrackOut FAIL |
| SCRAPPED | æŠ¥åºŸ | å¤„ç½®ä¸ºæŠ¥åºŸ |

### ä¸Šæ–™éªŒè¯ç»“æœ
- **PASS** (ç»¿è‰²): æ‰«ç ç‰©æ–™ = æœŸæœ›ç‰©æ–™
- **WARNING** (é»„è‰²): æ‰«ç ç‰©æ–™ = æ›¿ä»£æ–™
- **FAIL** (çº¢è‰²): ç‰©æ–™ä¸åŒ¹é…ï¼Œè¿ç»­ 3 æ¬¡ FAIL ä¼šé”å®šç«™ä½

## SMT å…¨æµç¨‹

1. **å·¥å•ä¸‹å‘** (/mes/work-orders): é€‰æ‹© RECEIVED å·¥å• â†’ ä¸‹å‘åˆ°äº§çº¿ â†’ åˆ›å»º Run
2. **å°±ç»ªæ£€æŸ¥** (Run è¯¦æƒ…é¡µ): ç‚¹å‡»"æ­£å¼æ£€æŸ¥"ï¼Œ6 é¡¹æ£€æŸ¥å…¨éƒ¨é€šè¿‡
3. **ä¸Šæ–™éªŒè¯** (/mes/loading): åŠ è½½ç«™ä½è¡¨ â†’ æ‰«ç éªŒè¯æ¯ä¸ªç«™ä½
4. **é¦–ä»¶æ£€éªŒ** (/mes/fai): åˆ›å»º FAI â†’ å¯åŠ¨ â†’ è¯•äº§ â†’ è®°å½•æ£€éªŒé¡¹ â†’ åˆ¤å®š PASS â†’ ç­¾å­—
5. **æˆæƒç”Ÿäº§** (Run è¯¦æƒ…é¡µ): ç‚¹å‡»"æˆæƒç”Ÿäº§"
6. **æ‰¹é‡æ‰§è¡Œ** (/mes/execution): é€‰æ‹©å·¥ä½ â†’ TrackIn â†’ å¡«å†™æ•°æ® â†’ TrackOut
7. **æ”¶å°¾** (Run è¯¦æƒ…é¡µ): ç‚¹å‡»"æ”¶å°¾" â†’ OQC æ£€éªŒ â†’ MRB å†³ç­–ï¼ˆå¦‚éœ€è¦ï¼‰
8. **è¿½æº¯** (/mes/trace): è¾“å…¥ SN æŸ¥è¯¢å®Œæ•´è®°å½•

## å¸¸è§é”™è¯¯ç åŠæ¢å¤

| é”™è¯¯ç  | å«ä¹‰ | æ¢å¤æ–¹å¼ |
|--------|------|----------|
| SLOT_LOCKED | ç«™ä½é”å®š | ç”¨ç­ç»„é•¿è´¦å·è§£é” |
| MATERIAL_MISMATCH | ç‰©æ–™ä¸åŒ¹é… | æ‰«æ­£ç¡®ç‰©æ–™ |
| SLOT_ALREADY_LOADED | ç«™ä½å·²ä¸Šæ–™ | ä½¿ç”¨"æ¢æ–™"åŠŸèƒ½ |
| READINESS_NOT_PASSED | å°±ç»ªæ£€æŸ¥æœªé€šè¿‡ | ä¿®å¤æˆ–è±å…å¤±è´¥é¡¹ |
| FAI_GATE_BLOCKED | FAI æœªé€šè¿‡ | å®Œæˆ FAI ä¸” PASS |
| RUN_NOT_AUTHORIZED | Run æœªæˆæƒ | å…ˆæˆæƒ |
| UNIT_NOT_FOUND | Unit ä¸å­˜åœ¨ | å…ˆç”Ÿæˆ Unit |

## æ¼”ç¤ºè´¦å·

| è§’è‰² | è´¦å· | å¯†ç  |
|------|------|------|
| ç®¡ç†å‘˜ | admin@example.com | ChangeMe123! |
| è®¡åˆ’å‘˜ | planner@example.com | Test123! |
| è´¨é‡å‘˜ | quality@example.com | Test123! |
| ç‰©æ–™å‘˜ | material@example.com | Test123! |
| æ“ä½œå‘˜ | operator@example.com | Test123! |

## é¡µé¢è·¯å¾„é€ŸæŸ¥

| åŠŸèƒ½ | è·¯å¾„ |
|------|------|
| å·¥å•ç®¡ç† | /mes/work-orders |
| æ‰¹æ¬¡ç®¡ç† | /mes/runs |
| ä¸Šæ–™éªŒè¯ | /mes/loading |
| é¦–ä»¶æ£€éªŒ | /mes/fai |
| å·¥ä½æ‰§è¡Œ | /mes/execution |
| è·¯ç”±ç®¡ç† | /mes/routes |
| OQC æ£€éªŒ | /mes/oqc |
| ç¼ºé™·ç®¡ç† | /mes/defects |
| è¿½æº¯æŸ¥è¯¢ | /mes/trace |
`;

/**
 * Generate the system prompt for the AI assistant
 * @param currentPath - Current page route
 * @param toolsEnabled - Whether tools are available
 */
export function generateSystemPrompt(currentPath?: string, toolsEnabled = false): string {
	const toolInstructions = toolsEnabled
		? `
## ğŸ”§ å·¥å…·ä½¿ç”¨ï¼ˆå¿…é¡»ä½¿ç”¨ï¼ï¼‰

ä½ æœ‰ä»¥ä¸‹å·¥å…·å¯ä»¥æŸ¥è¯¢ç³»ç»Ÿæ–‡æ¡£ï¼š

- \`read_file\`: è¯»å–æ–‡æ¡£æ–‡ä»¶
- \`list_directory\`: åˆ—å‡ºç›®å½•å†…å®¹
- \`search_code\`: æœç´¢å…³é”®è¯

### âš ï¸ é‡è¦ï¼šä½ å¿…é¡»ä½¿ç”¨å·¥å…·ï¼

**å½“ç”¨æˆ·é—®ä»»ä½•å…³äºç³»ç»ŸåŠŸèƒ½ã€æ“ä½œæµç¨‹çš„é—®é¢˜æ—¶ï¼Œä½ å¿…é¡»å…ˆç”¨å·¥å…·æŸ¥è¯¢æ–‡æ¡£ï¼Œç„¶ååŸºäºæŸ¥è¯¢ç»“æœå›ç­”ã€‚**

ä¸è¦ç›´æ¥è¯´"ä¸ç¡®å®š"æˆ–"ä¸çŸ¥é“"â€”â€”å…ˆæŸ¥ï¼

### æŸ¥è¯¢ç­–ç•¥

1. **å…ˆæœç´¢**ï¼š\`search_code("ç”¨æˆ·é—®çš„å…³é”®è¯")\` æ‰¾åˆ°ç›¸å…³æ–‡ä»¶
2. **å†è¯»å–**ï¼š\`read_file("æ‰¾åˆ°çš„æ–‡ä»¶è·¯å¾„")\` è·å–è¯¦ç»†å†…å®¹
3. **ç„¶åå›ç­”**ï¼šåŸºäºæ–‡æ¡£å†…å®¹å›ç­”ç”¨æˆ·

### é‡è¦æ–‡æ¡£ä½ç½®

| å†…å®¹ | è·¯å¾„ |
|------|------|
| SMT æ“ä½œæ‰‹å†Œ | \`domain_docs/mes/smt_playbook/\` |
| DIP æ“ä½œæ‰‹å†Œ | \`domain_docs/mes/dip_playbook/\` |
| æµç¨‹è§„èŒƒ | \`domain_docs/mes/spec/\` |
| ç”¨æˆ·æ¼”ç¤ºæŒ‡å— | \`user_docs/demo/\` |

### ç¤ºä¾‹

ç”¨æˆ·é—®"çƒ˜çƒ¤å‡†å¤‡æ€ä¹ˆåš"ï¼š
1. å…ˆ \`search_code("çƒ˜çƒ¤")\` æˆ– \`search_code("Bake")\`
2. æ ¹æ®æœç´¢ç»“æœè¯»å–ç›¸å…³æ–‡ä»¶
3. åŸºäºæ–‡ä»¶å†…å®¹å›ç­”

---`
		: "";

	const coreInstructions = `# Better MES ç³»ç»Ÿ AI åŠ©æ‰‹

ä½ æ˜¯ Better MES ç³»ç»Ÿçš„å†…ç½® AI åŠ©æ‰‹ã€‚
${toolInstructions}

## å›ç­”åŸåˆ™

${toolsEnabled ? "- **å…ˆæŸ¥åç­”**ï¼šæœ‰å·¥å…·å°±ç”¨å·¥å…·æŸ¥è¯¢ï¼Œä¸è¦å‡­ç©ºå›ç­”" : "- åŸºäºä¸‹æ–¹çŸ¥è¯†åº“å›ç­”"}
- **å‡†ç¡®ä¸ºå…ˆ**ï¼šåªè¯´æœ‰ä¾æ®çš„å†…å®¹
- **ç®€æ´æ¸…æ™°**ï¼šç”¨ä¸­æ–‡å›ç­”

---`;

	const basePrompt = `

${MES_KNOWLEDGE}`;

	if (currentPath) {
		const context = getRouteContext(currentPath);
		const routeContext = `

---

## å½“å‰é¡µé¢: ${context.name}

**è·¯å¾„**: \`${currentPath}\`
**è¯´æ˜**: ${context.description}

**å¯ç”¨æ“ä½œ**:
${context.actions.map((action) => `- ${action}`).join("\n")}

è¯·æ ¹æ®ç”¨æˆ·å½“å‰æ‰€åœ¨çš„ã€Œ${context.name}ã€é¡µé¢ï¼Œä¼˜å…ˆæä¾›ä¸è¯¥é¡µé¢ç›¸å…³çš„å¸®åŠ©ã€‚`;

		return coreInstructions + basePrompt + routeContext;
	}

	return coreInstructions + basePrompt;
}

/**
 * Generate prompt for suggestions generation
 * @param currentPath - Current page route
 */
export function generateSuggestionsPrompt(
	currentPath: string,
	reply?: string,
): { system: string; user: string } {
	const context = getRouteContext(currentPath);
	const normalizedReply = reply?.trim();

	if (normalizedReply) {
		const system = `ä½ æ˜¯ Better MES ç³»ç»Ÿçš„ AI åŠ©æ‰‹ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®åŠ©æ‰‹åˆšåˆšçš„å›å¤å†…å®¹ï¼Œç”Ÿæˆ 3-5 ä¸ªâ€œä¸‹ä¸€æ­¥å¯é—®â€çš„é—®é¢˜å»ºè®®ã€‚

è§„åˆ™ï¼š
1. é—®é¢˜å¿…é¡»ä¸å›å¤å†…å®¹çš„ä¸Šä¸‹æ–‡ç›¸å…³
2. é—®é¢˜åº”è¯¥ç®€çŸ­æ¸…æ™°ï¼ˆä¸è¶…è¿‡ 20 ä¸ªå­—ï¼‰
3. ä¼˜å…ˆç”Ÿæˆä¸‹ä¸€æ­¥æ“ä½œæˆ–ç»†èŠ‚è¿½é—®ç±»é—®é¢˜
4. ä¸è¦ä¾èµ–å½“å‰é¡µé¢è·¯å¾„æˆ–é¡µé¢åŠŸèƒ½
5. è¿”å› JSON æ•°ç»„æ ¼å¼

è¿”å›æ ¼å¼ï¼š
[
  {"question": "é—®é¢˜1", "action": "fill"},
  {"question": "é—®é¢˜2", "action": "send"},
  ...
]

action è¯´æ˜ï¼š
- "fill": å¡«å……åˆ°è¾“å…¥æ¡†ï¼Œç”¨æˆ·å¯ä»¥ä¿®æ”¹åå‘é€
- "send": ç›´æ¥å‘é€ï¼Œé€‚åˆç®€å•æ˜ç¡®çš„é—®é¢˜`;

		const user = `åŠ©æ‰‹å›å¤ï¼š\n${normalizedReply}\n\nè¯·ç”Ÿæˆ 3-5 ä¸ªä¸è¯¥å›å¤ç›¸å…³çš„å»ºè®®é—®é¢˜ã€‚`;

		return { system, user };
	}

	const system = `ä½ æ˜¯ Better MES ç³»ç»Ÿçš„ AI åŠ©æ‰‹ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ç”¨æˆ·å½“å‰æ‰€åœ¨çš„é¡µé¢ï¼Œç”Ÿæˆ 3-5 ä¸ªâ€œä¸‹ä¸€æ­¥å¯é—®â€çš„é—®é¢˜å»ºè®®ã€‚

è§„åˆ™ï¼š
1. é—®é¢˜å¿…é¡»ä¸å½“å‰é¡µé¢åŠŸèƒ½ç›´æ¥ç›¸å…³
2. é—®é¢˜åº”è¯¥ç®€çŸ­æ¸…æ™°ï¼ˆä¸è¶…è¿‡ 20 ä¸ªå­—ï¼‰
3. é—®é¢˜åº”è¯¥è¦†ç›–é¡µé¢çš„ä¸»è¦æ“ä½œåœºæ™¯
4. ä¼˜å…ˆç”Ÿæˆæ“ä½œæŒ‡å¯¼ç±»é—®é¢˜ï¼ˆå¦‚"æ€ä¹ˆåšXXX"ï¼‰
5. è¿”å› JSON æ•°ç»„æ ¼å¼

è¿”å›æ ¼å¼ï¼š
[
  {"question": "é—®é¢˜1", "action": "fill"},
  {"question": "é—®é¢˜2", "action": "send"},
  ...
]

action è¯´æ˜ï¼š
- "fill": å¡«å……åˆ°è¾“å…¥æ¡†ï¼Œç”¨æˆ·å¯ä»¥ä¿®æ”¹åå‘é€
- "send": ç›´æ¥å‘é€ï¼Œé€‚åˆç®€å•æ˜ç¡®çš„é—®é¢˜`;

	const user = `å½“å‰é¡µé¢ï¼š${context.name}
è·¯å¾„ï¼š${currentPath}
é¡µé¢è¯´æ˜ï¼š${context.description}
å¯ç”¨æ“ä½œï¼š${context.actions.join("ã€")}

è¯·ç”Ÿæˆ 3-5 ä¸ªä¸è¿™ä¸ªé¡µé¢ç›¸å…³çš„å»ºè®®é—®é¢˜ã€‚`;

	return { system, user };
}
