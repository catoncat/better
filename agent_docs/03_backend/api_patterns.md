# API Patterns

## Goal
- Standardize how API endpoints are structured in Elysia.

## When to Use
- Adding or modifying API routes.

## Module Layout
- Modules live in `apps/server/src/modules/*`.
- Keep modules focused (users, instruments, calibrations, notifications, system).

## Route Conventions
- Use `.get/.post/.patch/.delete` inside the module.
- Guard protected routes with `beforeHandle: requireAuthHook`.
- Access `db` and `currentUser` from the context (provided by plugins).

## Schemas and Validation
- Use TypeBox schemas generated by Prismabox.
- Import enums from `apps/server/src/types/prisma-enums.ts`.

## Pagination Defaults
- Default `pageSize`: 20
- Max `pageSize`: 100

## Transactions
- Use `db.$transaction` for multi-step writes.

## Related Docs
- `agent_docs/01_core/architecture_overview.md`
- `agent_docs/04_data/prisma.md`
